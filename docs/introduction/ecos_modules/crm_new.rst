Модуль CRM
===========

.. _ecos-crm:

Модуль поддерживает процессы маркетинга, продаж и обслуживания клиентов компании, а именно помогает:

	-	упорядочить и сохранить данные клиентов;
	-	обеспечить их практическое применение;
	-	отслеживать клиентов на каждом этапе продаж. 

.. contents::
		:depth: 5


Схема бизнес-процесса
----------------------

Лид
~~~~~

.. image:: _static/crm_new/lead_bp.png
       :width: 600
       :align: center

Сделка
~~~~~~~

.. image:: _static/crm_new/deal_bp.png
       :width: 600
       :align: center

Роли
----

.. list-table::
      :widths: 10 40
      :align: center
      :class: tight-table 
      
      * - **Менеджер по продажам**
        - Пользователь, запустивший сделку в работу. Видит только свои сделки.
      * - **Коммерческий директор**
        - Пользователь, принимающий решение по сделкам. Видит все сделки.
      * - **Все менеджеры CRM**
        - Пользователи - участники роли имеют право на просмотр всех сделок. В неё по умолчанию добавлена группа crm-manager. Если пользователь не входит в группу crm-manager, роль на него не распространяется.
      * - **Наблюдатели**
        - Пользователи, которым предоставляется дополнительный доступ на чтение к той или иной сделке.

Группы оргструктуры, в которые должны быть добавлены пользователи
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  * Менеджер CRM (crm-cco)
  * Коммерческий директор (crm-manager)

В каком рабочем пространстве доступен
---------------------------------------

Модуль доступен в :ref:`рабочем пространстве<workspaces>` **CRM**:

.. image:: _static/crm_new/overview.png
       :width: 700
       :align: center

Рабочее пространство содержит:

1.	**Задачи**

  -	**Текущие задачи** - все задачи, которые могут быть выполнены пользователем, как единственным исполнителем, так и в составе групп.
  -	**Завершенные задачи** - выполненные пользователем задачи
  -    **Задачи подчиненных** - задачи пользователей, у которых текущий пользователь указан в их профилях как Линейный руководитель.

2.	**Разделы**

  -	**Журналы** по основному направлению рабочего пространства - **Лиды, Сделки, Заказы, Платежи, Договоры, Доп. Соглашения**
  -	**Библиотека документов** - иерархический интерфейс для работы с папками и документами. См. подробно о :ref:`библиотеке документов<ws_doc_library>`.
  -	**Доска поручений** - наглядное представление задач участников рабочего пространства в виде виртуальной доски. См. подробно :ref:`канбан доске<ws_kanban>`.

3.	**Справочники**

Справочники, которые используются в данном рабочем пространстве. Справочники необходимо заполнить данными.

.. image:: _static/crm_new/datalist_01.png
       :width: 700
       :align: center

Лиды
-----

**Лиды** – потенциальные клиенты, которые заинтересовались продуктом. 

Возможные этапы лида:

 • Не обработана
 • Есть интерес
 • Пауза
 • Дисквалифицирован
 • Сделка

.. image:: _static/crm_new/lead_01.png
       :width: 700
       :align: center

Для наглядного представления статуса лидов доступна канбан доска:

.. image:: _static/crm_new/lead_02.png
       :width: 700
       :align: center

Создание карточки
~~~~~~~~~~~~~~~~~~~~~

Создание лида возможно как с помощью кнопки быстрого создания:

.. image:: _static/crm_new/lead_03.png
       :width: 350
       :align: center

или из журнала **«Лиды»** по кнопке **+**. 

В карточке заполните необходимые и обязательные поля и нажмите **«Создать»**.

.. image:: _static/crm_new/lead_04.png
       :width: 600
       :align: center

.. _lead_contacts:

Для ввода данных о контактах лида, дополнительной информации о нем перейдите в карточку, нажав:

.. image:: _static/crm_new/lead_05.png
       :width: 600
       :align: center
 
Карточка лида состоит из :ref:`виджетов<widgets>`

.. image:: _static/crm_new/lead_06.png
       :width: 600
       :align: center

Нажмите значок редактирования, заполните данные и сохраните:

.. list-table::
      :widths: 20 20
      :align: center

      * - |

            .. image:: _static/crm_new/lead_07.png
                  :width: 500
                  :align: center

        - |

            .. image:: _static/crm_new/lead_08.png
                  :width: 500
                  :align: center

Редактирование карточки
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. image:: _static/crm_new/lead_08_1.png
       :width: 600
       :align: center

Изменение статуса
~~~~~~~~~~~~~~~~~~~~

.. _lead_change_status:

Статус можно изменить как через соответствующее действие в карточке:

.. image:: _static/crm_new/lead_09.png
       :width: 250
       :align: center

или перемещая карточку по канбан доске:

.. image:: _static/crm_new/lead_10.png
       :width: 700
       :align: center

или через действие в журнале:

.. image:: _static/crm_new/lead_02_1.png
       :width: 700
       :align: center

Дисквалификация
~~~~~~~~~~~~~~~~~~~~~

**Дисквалификация** – процесс отсеивания неподходящих потенциальных клиентов.

:ref:`Измените статус <lead_change_status>` лида на **«Дисквалифицирован»** и выберите причину дисквалификации, сохраните:

.. image:: _static/crm_new/lead_11.png
       :width: 500
       :align: center

Причина будет указана в карточке:

.. image:: _static/crm_new/lead_11_1.png
       :width: 600
       :align: center

Создание контрагента
~~~~~~~~~~~~~~~~~~~~~
До создания сделки в будущем необходимо создать контрагента из лида или выбрать его из справочника, если он был заведен заранее.

Для этого выберите действие **«Создать контрагента»**, заполните во всех вкладках карточки обязательные поля. Чтобы автоматически заполнить поля с реквизитами, заполните **ИНН** и далее нажмите **«Автозаполнение»**:

.. image:: _static/crm_new/lead_12.png
       :width: 700
       :align: center

Далее выберите созданного контрагента в карточке лида и сохраните:

.. image:: _static/crm_new/lead_13.png
       :width: 600
       :align: center

Создание сделки
~~~~~~~~~~~~~~~~~~~~~

.. _lead_deal:

.. note::

 Поле **«Контрагент»** должно быть заполнено.

Переведите лида в статус **«Сделка»**:

.. image:: _static/crm_new/lead_14.png
       :width: 600
       :align: center
 
Статус лида меняется на **«Сделка»** - создается **сделка** в статусе **«Не обработана»** с данными из карточки лида:

.. image:: _static/crm_new/lead_15.png
       :width: 600
       :align: center

В карточке лида автоматически указывается созданная сделка.

Сделка
-------

Возможные этапы сделки:

 • Не обработана
 • Первичный контакт
 • Сбор потребностей
 • Презентация
 • Подготовка КП
 • Прототип
 • Принятие решения
 • Завершена
 • Пауза
 • Отказ
 • Отсев
 • Исторические заявки - неактуальные заявки

.. image:: _static/crm_new/deal_01.png
       :width: 700
       :align: center

Для наглядного представления статуса сделок доступна канбан доска:

.. image:: _static/crm_new/deal_02.png
       :width: 700
       :align: center

Создание карточки
~~~~~~~~~~~~~~~~~~

Сделка может быть :ref:`создана из лида <lead_deal>`,  и тогда в сделке это будет отмечено:

.. image:: _static/crm_new/deal_03.png
       :width: 500
       :align: center

или как самостоятельная сделка:

-	с помощью кнопки быстрого создания:

.. image:: _static/crm_new/deal_04.png
       :width: 350
       :align: center

-	из журнала **«Сделки»** по кнопке **+**. 

Карточка состоит из вкладок:

-	на вкладке **«Основное»** заполните необходимые и обязательные поля и нажмите **«Создать»**.

.. image:: _static/crm_new/deal_05.png
       :width: 600
       :align: center

-	на вкладке **«Продукты и услуги»** выберите из списка или создайте **продукт/услугу**:

.. image:: _static/crm_new/deal_06.png
       :width: 600
       :align: center

Рассмотрим выбор из справочника. Выберите **продукт/услугу**, нажмите **ОК**:

.. image:: _static/crm_new/deal_07.png
       :width: 600
       :align: center

Уточните представленную информацию, внесите изменения под эту сделку (если они есть) и сохраните:

.. image:: _static/crm_new/deal_08.png
       :width: 600
       :align: center

Заполненная вкладка:

.. image:: _static/crm_new/deal_09.png
       :width: 600
       :align: center

Сохраните карточку, нажав **«Создать»**. 

Ввести данные о контактах по сделке и дополнительной информации можно в виджеты **«Контакты»**, **«Маркетинг»**, аналогично как :ref:`карточке люда<lead_contacts>`.

Карточка сделки
~~~~~~~~~~~~~~~~~~

.. image:: _static/crm_new/deal_10.png
       :width: 600
       :align: center

Карточка состоит из следующих виджетов:

1.	Виджет :ref:`«Стадии»<widget_stages>` визуализирует прохождение статусов сделки и доступен только в enterprise версии.

  .. image:: _static/crm_new/stages.png
        :width: 600
        :align: center

  Как соответствуют статусы стадиям:

  .. list-table::
        :widths: 20 50
        :header-rows: 1
        :align: center
        :class: tight-table 
              
        * - Стадия
          - Соответствующие статусы
        * - **0% - Обработка**
          - Не обработана
        * - **20% - Квалификация**
          - Первичный контакт, Сбор потребностей
        * - **40% - Развитие**
          - Презентация, Подготовка КП, Прототип
        * - **60% - Подтверждение**
          - Принятие решения
        * - **100% - Победа**
          - Завершена
        * - **Отказ/Пауза**
          - Отказ, Пауза

2.	Виджет **«Мои задачи»** отображает задачи по сделке у просматривающего его пользователя и варианты их завершения.
3.	Виджет **«Свойства»**, **«Контакты»**, **«Маркетинг»** отображает информацию по сделке. **Почтовое сообщение** содержит информацию из письма, направленного на email. См. ниже раздел :ref:`Создание сделки из письма<email-deal>`
4.	Виджет **«Статус»** отображает текущий статус сделки.
5.	Виджет **«Все задачи»** отображает задачи по заявке и их исполнителей.
6.	Виджет **«Действия»** содержит перечень доступных действий со сделкой на данном статусе.
7.  Виджет :ref:`«Активности»<widget_activities>` помогает отслеживать этапы работы со сделкой и просматривать все запланированные и завершённые задачи (активности). 
    Виджет доступен только в enterprise версии.
8.	Виджет **«Связи документа»** для установки связей сделки с другими объектами Citeck и отображения установленных связей.

В карточке доступны вкладки:

 • Основное
 • Продукты и услуги
 • Заказы
 • Платежи

О вкладках подробно описано ниже.

Редактирование карточки
~~~~~~~~~~~~~~~~~~~~~~~~~

.. image:: _static/crm_new/deal_10_1.png
       :width: 600
       :align: center

Изменение статуса
~~~~~~~~~~~~~~~~~~~~

.. _deal_change_status:

Статус можно изменить как через соответствующее действие в карточке:

.. image:: _static/crm_new/deal_11.png
       :width: 250
       :align: center

или перемещая карточку по канбан доске:

.. image:: _static/crm_new/deal_12.png
       :width: 700
       :align: center

или через действие в журнале:

.. image:: _static/crm_new/deal_13.png
       :width: 700
       :align: center

Генерация КП
~~~~~~~~~~~~~~~~

Выберите действие **«Сгенерировать КП»** и по выбранным продуктам/услугам, данным сделки по шаблону сформируется коммерческое предложение, которое будет доступно во вкладке **«Документы»**:

.. image:: _static/crm_new/deal_14.png
       :width: 600
       :align: center

По клику на имя файла открывается документ:
 	
.. list-table::
      :widths: 20 20
      :align: center

      * - |

            .. image:: _static/crm_new/deal_15.png
                  :width: 500
                  :align: center

        - |

            .. image:: _static/crm_new/deal_16.png
                  :width: 500
                  :align: center   

Для документа доступны действия:

  •	:ref:`Загрузить новую версию<action_version>`
  •	Скачать
  •	:ref:`Печатать<action_print>`
  •	:ref:`Редактировать документ<edit_only_office>`

Создание договора
~~~~~~~~~~~~~~~~~~

Для добавления договора на основании сделки нажмите **«Выбрать»**:

.. image:: _static/crm_new/deal_17.png
       :width: 600
       :align: center

Далее **«Создать»**:

.. image:: _static/crm_new/deal_18.png
       :width: 600
       :align: center

И в открывшейся форме заполните обязательные и необходимые поля:

.. image:: _static/crm_new/deal_19.png
       :width: 600
       :align: center
 
Дальнейший порядок работы с договором описан в :ref:`модуле «Договоры»<ecos-contract>`.

И чтобы договор привязался к карточке, выберите его из списка:

.. image:: _static/crm_new/deal_20.png
       :width: 600
       :align: center
 
Сохраните карточку:

.. image:: _static/crm_new/deal_21.png
       :width: 600
       :align: center

Изменение/назначение ответственного
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note::

       Действие доступно пользователю с ролью Коммерческий директор (crm-manager)

Выберите действие **«Назначить ответственного»**, выберите сотрудника из оргструктуры, нажмите **«Назначить»**:

.. image:: _static/crm_new/deal_44.png
       :width: 500
       :align: center


Создание и работа с заказом
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Создание заказа
""""""""""""""""""

Для создания заказа по сделке в карточке перейдите во вкладку **«Заказы»**:

.. image:: _static/crm_new/deal_22.png
       :width: 600
       :align: center
 
Нажмите **«Создать»**:

.. image:: _static/crm_new/deal_23.png
       :width: 600
       :align: center
 
И в карточке создайте/ выберите продукты/услуги:

.. image:: _static/crm_new/deal_24.png
       :width: 600
       :align: center
 
Внесите изменения под данный заказ и сохраните:

.. image:: _static/crm_new/deal_25.png
       :width: 600
       :align: center
 
Сохраните карточку заказа, нажав **«Создать»**:

.. image:: _static/crm_new/deal_26.png
       :width: 600
       :align: center
 
Сохраните карточку сделки и перейдите в карточку заказа:

.. image:: _static/crm_new/deal_27.png
       :width: 600
       :align: center
 
Карточка заказа:

.. image:: _static/crm_new/deal_28.png
       :width: 600
       :align: center

Документы по заказу
""""""""""""""""""""""

Счет
*****

В карточке заказа выберите действие **«Сформировать счет»**. На основании данных юридического лица из договора и указанных продуктах/услугах в заявке, будет сформирован счет, который будет доступен во вкладке **«Документы»**:

.. image:: _static/crm_new/deal_29.png
       :width: 600
       :align: center

По клику на имя файла открывается документ:

.. image:: _static/crm_new/deal_30.png
       :width: 500
       :align: center
 
Для документа доступны действия:
  •	:ref:`Загрузить новую версию<action_version>`
  •	Скачать
  •	:ref:`Печатать<action_print>`
  •	:ref:`Редактировать документ<edit_only_office>`

Акт
*****

В карточке заказа выберите действие **«Сформировать акт»**. На основании данных юридического лица из договора и указанных продуктах/услугах в заявке, будет сформирован акт, который будет доступен во вкладке **«Документы»**:

.. image:: _static/crm_new/deal_31.png
       :width: 600
       :align: center

По клику на имя файла открывается документ:

.. image:: _static/crm_new/deal_32.png
       :width: 500
       :align: center

Для документа доступны действия:
  •	:ref:`Загрузить новую версию<action_version>`
  •	Скачать
  •	:ref:`Печатать<action_print>`
  •	:ref:`Редактировать документ<edit_only_office>`

Изменение статуса счета, акта
""""""""""""""""""""""""""""""""

Статус можно изменить как через соответствующее действие в карточке:
 
.. image:: _static/crm_new/deal_33.png
       :width: 500
       :align: center

Создание и работа с платежом
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Создание платежа
"""""""""""""""""""
Для создания платежа по сделке в карточке перейдите во вкладку **«Платежи»**:

.. image:: _static/crm_new/deal_34.png
       :width: 600
       :align: center
 
Нажмите **«Создать»**:

.. image:: _static/crm_new/deal_35.png
       :width: 600
       :align: center
 
Укажите сумму, выберите заказ, заполните необходимые поля и сохраните.
Сохраните карточку сделки и перейдите в карточку платежа:

.. image:: _static/crm_new/deal_36.png
       :width: 600
       :align: center
 
Карточка заказа:

.. image:: _static/crm_new/deal_37.png
       :width: 600
       :align: center
 
Изменение статуса
"""""""""""""""""""

Статус можно изменить как через соответствующее действие в карточке:

.. image:: _static/crm_new/deal_38.png
       :width: 500
       :align: center
 
Для статуса **«Запланирован»** укажите **Планируемую дата платежа**.
Для статуса **«Оплачен»** укажите **Фактическую дату платежа**.

.. image:: _static/crm_new/deal_39.png
       :width: 500
       :align: center

Объедение с основной сделкой
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для объединения сделок выберите в карточке действие **«Объединить с основной сделкой»**:

 .. image:: _static/crm_new/deal_40.png
       :width: 500
       :align: center

Выберите из списка **сделку**, в которую переносить данные:

 .. image:: _static/crm_new/deal_41.png
       :width: 500
       :align: center

Подтвердите объединение:

 .. image:: _static/crm_new/deal_42.png
       :width: 500
       :align: center

В выбранную при объединении карточку сделки будут перенесены **данные контакта**. А в комментарий к сделке будет перенесена вся **информация о ней**:

 .. image:: _static/crm_new/deal_43.png
       :width: 600
       :align: center

Создание поручения по сделке
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Cоздать поручение можно из карточки сделки, выбрав действие **«Создать поручение»**. См. подробно :ref:`Создание поручения из карточки<ecos-assignments-action>`

Клиенты
----------

Содержит список контрагентов, по умолчанию представлены контрагенты с типом **Покупатель**:

.. image:: _static/crm_new/client_01.png
       :width: 700
       :align: center

Фильтр можно сбросить.

Создание сделки из письма
----------------------------

.. _email-deal:

При создании сделки из письма данные из письма парсятся в карточку Сделки, в результате заполняются поля:

  * **Название** - заполняется названием компании из письма;
  * **Компания** - заполняется названием компании из письма;
  * **Контрагент** - заполняется ссылкой на карточку контрагента, если он есть в системе;
  * **Контактные лица** - в случае, если контакт новый, то он добавляется в список контактов в сделке и в карточке контрагента;
  * **Количество пользователей** - заполняется из письма;
  * **Категория обращения** - заполняется из журнала в соответствии с темой письма;
  * **Описание** - заполняется текстом комментария из письма.

Настройки для парсинга писем
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Перейдите в журнал :ref:`«Конфигурация ECOS»<configuration_admin>`. Настройка **mail-inbox-crm (Конфигурация почтового ящика IMAP для чтения писем в CRM Camel route)**:

 .. image:: _static/crm/CRM_8.png
       :width: 700
       :align: center

Например:

 .. image:: _static/crm/CRM_9.png
       :width: 400
       :align: center

.. code-block::

  imaps://imap.mail.ru?username=testuser1@mail.ru&password=somePassword&delete=false&unseen=true&delay=30 

Где:

.. list-table::
      :widths: 3 5
      :align: center
      :class: tight-table 
      
      * - **username**
        - адрес электронной почты, которая будет обеспечивать обработку сообщений
      * - **password**
        - пароль для подключения
      * - **delete**
        - | удалять ли сообщения в почте после обработки. Это делается путем установки флага **DELETED** в почтовом сообщении. 
          | Если false, вместо этого устанавливается флаг **SEEN**.
      * - **unseen**
        - ограничиваться ли только непрочтенными письмами.
      * - **delay**
        - частота проверки почтового ящика (указывается в миллисекундах)

Включение обработки писем в активности
----------------------------------------

.. _mail-inbox-activity:

Для включения обработки писем в виджете "Активности" необходимо указать почтовый ящик в настройке **mail-inbox-activity (Конфигурация почтового ящика IMAP для чтения писем в Activity Camel Route)** аналогично, как описано выше.

.. note:: 

  Желательно, чтобы обработка писем в активности и создания сделок, осуществлялось через разные почтовые ящики.

Чтобы письмо обрабатывалось и добавлялось как активность, необходимо в тип **сделка** добавить и настроить аспект :ref:`Имеет активности<has-ecos-activities_aspect>`.

Если в письме было вложение, то в виджете :ref:`Активности<widget_activities>` создается запись с типом **Письмо**, содержащая текст письма и само вложение.