Модуль CRM
===========

.. _ecos-crm:

.. note::

  На :ref:`демо<demo_info>` стенде доступна обновленная :ref:`версия CRM<ecos-crm_new>`

Модуль поддерживает процессы маркетинга, продаж и обслуживания клиентов компании, а именно помогает:

	-	упорядочить и сохранить данные клиентов;
	-	обеспечить их практическое применение;
	-	отслеживать клиентов на каждом этапе продаж. 

.. contents::
		:depth: 2

Роли
----

.. list-table::
      :widths: 10 40
      :align: center
      :class: tight-table 
      
      * - **Менеджер по продажам**
        - Пользователь, запустивший сделку в работу. Видит только свои сделки.
      * - **Коммерческий директор**
        - Пользователь, принимающий решение по сделкам. Видит все сделки.
      * - **Все менеджеры CRM**
        - Пользователи - участники роли имеют право на просмотр всех сделок. В неё по умолчанию добавлена группа crm-manager. Если пользователь не входит в группу crm-manager, роль на него не распространяется.
      * - **Наблюдатели**
        - Пользователи, которым предоставляется дополнительный доступ на чтение к той или иной сделке.

Группы оргструктуры, в которые должны быть добавлены пользователи
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  * Менеджер CRM (crm-cco)
  * Коммерческий директор (crm-manager)

Статусы
--------

.. list-table::
      :widths: 20 60
      :align: center
      :class: tight-table 
      
      * - **Не обработана**
        - Новая сделка
      * - **Первичный контакт**
        - Общение с потенциальным заказчиком
      * - **Сбор потребностей**
        - Уточнение и формирование требований заказчика
      * - **Презентация**
        - Подготовка презентации компании, продукта
      * - **Подготовка КП**
        - Подготовка коммерческого проекта
      * - **Прототип**
        - Подготовка прототипа продукта
      * - **Принятие решения**
        - Принятие решения по сделке
      * - **Завершена**
        - Успешное завершение сделки
      * - **Пауза**
        - Пауза по сделке
      * - **Отказ**
        - Отказ по сделке
      * - **Отсев**
        - Сделка переведена в отсев
      * - **Исторические заявки**
        - Неактуальные заявки

В каком рабочем пространстве доступен
---------------------------------------

Модуль доступен в :ref:`рабочем пространстве<workspaces>` **CRM**.

Журнал и канбан доска
-----------------------

 .. image:: _static/crm/CRM_1.png
       :width: 700
       :align: center

Для журнала доступно представление :ref:`канбан<kanban_board>`. Столбцы соответствуют статусам сделки.

 .. image:: _static/crm/CRM_12.png
       :width: 700
       :align: center


Создание сделки
------------------

Создание сделки возможно как с помощью кнопки быстрого создания: 

 .. image:: _static/crm/CRM_2.png
       :width: 300
       :align: center


так и из журнала **«Сделки»**:

 .. image:: _static/crm/CRM_3.png
       :width: 700
       :align: center

На экране становится доступна форма создания Сделки:

 .. image:: _static/crm/CRM_4.png
       :width: 600
       :align: center

.. list-table::
      :widths: 20 60
      :class: tight-table 
      
      * - **Раздел «Основное»**
        - Содержит основную информацию о сделке
      * - **Номер**
        - Номер сделки. Заполняется автоматически после сохранения
      * - **Название**
        - Наименование сделки.
      * - **Компания**
        - Наименование компании.
      * - **Контрагент**
        - Выбрать из справочника контрагента, если он уже является клиентом
      * - **Бюджет**
        - Бюджет сделки
      * - **Ответственный**
        - Выбрать из справочника менеджера, ответственного за сделку
      * - **Наблюдатели**
        - Выбрать из справочника пользователей, которым предоставляется дополнительный доступ на чтение к сделке
      * - **Дата создания**
        - Заполняется автоматически, может быть изменена
      * - **Описание**
        - Описание запроса потенциального клиента
      * - **Категория обращения**
        - | Выбрать из справочника категорию, к которому относится сделка. Например:
          | - Другое;
          | - Сарафанное радио;
          | - Телефон;
          | - Почта;
          | - Сайт - запрос стоимости
          | - Сайт - консультация
          | - Сайт - запрос демонстрации
      * - **Источник обращения**
        - | Выбрать из справочника источник информации, из которого клиент узнал о вас и об услугах, которые вы предоставляете. На данный момент доступны:
          | - Google поиск — нашли через Google поиск;
          | - Yandex поиск  — нашли через Яндекс поиск;
          | - Переход со стороннего сайта;
          | - Реклама в Яндекс.Директ;
          | - Прямая ссылка, т.е. пользователь указал адрес сайта сам, перешёл из избранного и т.д.;
          | - Письмо из почты;
          | - По знакомству;
          | - Другое — для разбора вручную (например, переходы из мессенджеров или соцсетей);
          | - Неизвестный.
      * - **Раздел «Контактные лица»**
        - Содержит информацию о контактных лицах. Контактов может быть несколько - для добавления используйте кнопку **+ Добавить еще**
      * - **ФИО**
        - ФИО представителя компании
      * - **Департамент**
        - Департамент представителя 
      * - **Должность**
        - Должность представителя
      * - **Телефон**
        - Номер телефона представителя 
      * - **E-mail**
        - Адрес электронной почты представителя
      * - **Основной**
        - Если контактов несколько, выставите для отметки контакта основным для данной сделки
      * - **Комментарий**
        - Дополнительная информация
      * - **Раздел «Заявка с сайта»**
        - Содержит информацию, если заявка была заполнена на сайте
      * - **Страница заполнения заявки**
        - Информация из заявки, которую заполняет представитель
      * - **Идентификатор GA**
        - Идентификатор тега Google Analytics
      * - **Идентификатор YM**
        - Идентификатор тега Яндекс. Метрики
      * - **Раздел Почтовое сообщение**
        - Содержит информацию из письма, направленного на email. См. ниже раздел :ref:`Создание сделки из письма<email-deal>`

Карточка сделки с виджетами
-----------------------------

 .. image:: _static/crm/CRM_5.png
       :width: 600
       :align: center

Карточка состоит из следующих виджетов:

  1.	**Виджет «Стадии»** визуализирует прохождение статусов сделки. См. подробно ниже.
  2.	**Виджет «Мои задачи»** отображает задачи по сделке у просматривающего его пользователя и варианты их завершения.
  3.  **Виджет «Свойства»** отображает информацию по сделке. 
  4.  **Виджет «Статус»** отображает текущий статус сделки.
  5.  **Виджет «Все задачи»** отображает задачи по заявке и их исполнителей.
  6.  **Виджет «Действия»** содержит перечень доступных действий со сделкой на данном статусе. См. подробно ниже.
  7.  **Виджет «Активности»** помогает отслеживать этапы работы со сделкой и просматривать все запланированные и завершённые задачи (активности). Подробно о виджете :ref:`«Активности»<widget_activities>`. Виджет доступен только в **enterprise** версии.
  8.	**Виджет «Связи документа»** для установки связей данного заявки с другими и отображения установленных связей.

Виджет «Стадии»
~~~~~~~~~~~~~~~~~~

.. note::

	Виджет доступен только в **enterprise** версии.

Карточка сделки содержит виджет :ref:`«Стадии»<widget_stages>`.

 .. image:: _static/crm/CRM_6.png
       :width: 600
       :align: center

Виджет визуализирует прохождение статусов сделки:

.. list-table::
      :widths: 20 50
      :header-rows: 1
      :align: center
      :class: tight-table 
            
      * - Стадия
        - Соответствующие статусы
      * - **0% - Обработка**
        - Не обработана
      * - **20% - Квалификация**
        - Первичный контакт, Сбор потребностей
      * - **40% - Развитие**
        - Презентация, Подготовка КП, Прототип
      * - **60% - Подтверждение**
        - Принятие решения
      * - **100% - Победа**
        - Завершена
      * - **Отказ/Пауза**
        - Отказ, Пауза


Задача взятия в работу
-----------------------

Если при создании сделки в карточке не выбран ответственный, то на группу **Менеджер CRM** назначается **«Задача взятия в работу»**:

 .. image:: _static/crm/elimination_task.png
       :width: 600
       :align: center

доступны следующие варианты завершения задачи:

  -	**«Перевести в статус отсев»** - принято решение не брать сделку в работу. Сделка переходит в статус **«Отсев»**.

  -	**«Взять в работу»** - принято решение начать работу по сделке. Сделка переходит в статус **«Первичный контакт»**.

Действия со сделкой
---------------------

Смена статуса
~~~~~~~~~~~~~~~~~~

Переход между статусами осуществляется через канбан доску перемещением карточки по столбцам. Столбцы соответствуют статусам сделки.

 .. image:: _static/crm/CRM_7.png
       :width: 700
       :align: center

Или **«Ответственному»** через действие **«Изменить статус»**:

 .. image:: _static/crm/CRM_10.png
       :width: 250
       :align: center

выберите необходимый статус и нажмите **«Отправить»**:

 .. image:: _static/crm/CRM_11.png
       :width: 500
       :align: center

Назначение/ изменение ответственного
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для назначения/ изменения ответственного выберите в карточке действие **«Назначить ответственного»**. Выберите сотрудника из оргструктуры и нажмите **«Назначить»**:

.. list-table::
      :widths: 20 20
      :align: center

      * - |

            .. image:: _static/crm/responsible_2.png
                  :width: 500
                  :align: center

        - |

            .. image:: _static/crm/responsible_3.png
                  :width: 500
                  :align: center

Объединение сделок
~~~~~~~~~~~~~~~~~~

Для объединения сделок выберите в карточке действие **«Объединить с основной сделкой»**:

 .. image:: _static/crm/CRM_merge_1.png
       :width: 500
       :align: center

Выберите из списка **сделку**, в которую переносить данные:

 .. image:: _static/crm/CRM_merge_2.png
       :width: 500
       :align: center

Подтвердите объединение:

 .. image:: _static/crm/CRM_merge_3.png
       :width: 500
       :align: center

В выбранную при объединении карточку сделки будут перенесены **данные контакта**. А в комментарий к сделке будет перенесена вся **информация о ней**:

 .. image:: _static/crm/CRM_merge_4.png
       :width: 600
       :align: center

Создание контрагента
~~~~~~~~~~~~~~~~~~~~~

Cоздать контрагента можно из карточки сделки, выбрав действие **«Создать конрагента»**. Открывается карточка создания конрагента, предзаполненная данными из сделки:

 .. image:: _static/crm/CRM_KA.png
       :width: 600
       :align: center

дозаполните обязательные поля и нажмите **Создать**.

Создание поручения по сделке
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Cоздать поручение можно из карточки сделки, выбрав действие **«Создать поручение»**. См. подробно :ref:`Создание поручения из карточки<ecos-assignments-action>`

Создание сделки из письма
----------------------------

.. _email-deal:

При создании сделки из письма данные из письма парсятся в карточку Сделки, в результате заполняются поля:

  * **Название** - заполняется названием компании из письма;
  * **Компания** - заполняется названием компании из письма;
  * **Контрагент** - заполняется ссылкой на карточку контрагента, если он есть в системе;
  * **Контактные лица** - в случае, если контакт новый, то он добавляется в список контактов в сделке и в карточке контрагента;
  * **Количество пользователей** - заполняется из письма;
  * **Категория обращения** - заполняется из журнала в соответствии с темой письма;
  * **Описание** - заполняется текстом комментария из письма.

Настройки для парсинга писем
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Настройка **mail-inbox-crm (Конфигурация почтового ящика IMAP для чтения писем в CRM Camel route)**:

 .. image:: _static/crm/CRM_8.png
       :width: 700
       :align: center

Например:

 .. image:: _static/crm/CRM_9.png
       :width: 400
       :align: center

.. code-block::

  imaps://imap.mail.ru?username=testuser1@mail.ru&password=somePassword&delete=false&unseen=true&delay=30 

Где:

.. list-table::
      :widths: 3 5
      :align: center
      :class: tight-table 
      
      * - **username**
        - адрес электронной почты, которая будет обеспечивать обработку сообщений
      * - **password**
        - пароль для подключения
      * - **delete**
        - | удалять ли сообщения в почте после обработки. Это делается путем установки флага **DELETED** в почтовом сообщении. 
          | Если false, вместо этого устанавливается флаг **SEEN**.
      * - **unseen**
        - ограничиваться ли только непрочтенными письмами.
      * - **delay**
        - частота проверки почтового ящика (указывается в миллисекундах)

Включение обработки писем в активности
----------------------------------------

.. _mail-inbox-activity:

Для включения обработки писем в виджете "Активности" необходимо указать почтовый ящик в настройке **mail-inbox-activity (Конфигурация почтового ящика IMAP для чтения писем в Activity Camel Route)** аналогично, как описано выше.

.. note:: 

  Желательно, чтобы обработка писем в активности и создания сделок, осуществлялось через разные почтовые ящики.

Чтобы письмо обрабатывалось и добавлялось как активность, необходимо в тип **сделка** добавить и настроить аспект :ref:`Имеет активности<has-ecos-activities_aspect>`.

Если в письме было вложение, то в виджете :ref:`Активности<widget_activities>` создается запись с типом **Письмо**, содержащая текст письма и само вложение.