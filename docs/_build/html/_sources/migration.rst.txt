Миграция
=========

Миграция с 3.*-4.2 (core) 2.2 (micro) на 4.3+ (core) 2.3 (micro)
------------------------------------------------------------------

1. Перенести формы в alfresco из папки **{moduleId}/ecos-forms** в папку **{moduleId}/ui/form**;
2. Поменять у всех ссылок на формы префикс с **uiserv/eform@** на **uiserv/form@**;
3. В корне конфигурации журнала поменять **label** на **name**;
4. В конфигурации колонок журнала поменять name на id и затем **label** на **name**;
5. В конфигурации журнала убрать **sourceId** (он будет браться из типа);
6. Описание групповых операций в журнале нужно переместить в **actionsDef** (см. модуль ecos-finance за примером);
7. В журнале наследование действий из типа регулируется параметром **actionsFromType** (true - наследовать всегда, false - никогда, null - наследовать если действий нет в **actionsDef/actions**). По умолчанию null. Выставить false если в журнале не должно быть действий
8. Варианты создания переместить из конфигурации журнала в конфигурацию типа;
9. В конфигурации типа переименовать attributes в properties;
10. Для связи типа ECOS с типом Alfresco: в конфигурации типа добавить **properties.alfType** с типом из модели alfresco и в **properties.alfRoot** путь до папки куда будут попадать новые записи. прим: Для новых типов тип альфреско создавать не нужно если нет такого требования в задаче;
11. Убрать варианты создания из конфигурации журналов в типы;
12. Убрать **recordRef** из варианта создания (он сформируется из **sourceId** в типе);
13. Убрать **attributes._parent** из варианта создания (для размещения сущностей будет использовано расположение по умолчанию или **properties.alfRoot** из типа);
14. Проставить **parentRef** в типе. Если это кейс, то родительский тип **emodel/type@case**. Если тип - элемент даталист, то тип **emodel/type@data-list**;
15. С версии 4.3 (2.3) в каждом типе где есть форма и не стоит флаг **defaultCreateVariant: false** генерируется вариант создания по умолчанию. В большинстве случаев его хватает и описывать свой вариант не нужно;
16. Убрать из конфига журнала следующую конструкцию:
::
   predicate:
      t: and
      val:
        - { t: eq, att: _type, val: ''}
        - { t: eq, att: TYPE, val: idocs:personAttorney }

В версии 4.3+ предикат с клиента отправляется с типом ECOS, а уже на сервере подменяется на тип alfresco если проставлено свойство **properties.alfType**.

17. Для настройки **journalId** у фильтра в журнале теперь предусмотрен следующий механизм в порядке от предпочтительного варианта к менее предпочтительному:
    a) В типе настраиваем **model.attributes[{id: some:assocName, type: ASSOC, config: { typeRef: “emodel/type@assoc-target-type“ }}]**
    b) В конфигурации колонки журнала прописываем editor: **{ type: journal, config: { journalId: 'general-case' }}**
18. Конфигурации controller в колонке журнала больше нету. Вместо него предусмотрены два других поля: **formatter** и **editor**.
19. Типы колонок в журнале теперь выбираются из списка  {ASSOC, PERSON, AUTHORITY_GROUP, AUTHORITY, TEXT, MLTEXT, NUMBER, BOOLEAN, DATE, DATETIME, CONTENT }. На uiserv настроен маппинг старых типов на новые, но лучше их тоже мигрировать.
20. Все ссылки на ноды alfresco теперь следует указывать с добавлением префикса **alfresco/@**. Пример: **alfresco/@workspace://SpacesStore/….**. 
21. В типе обязательно проставляем (если они есть) journalRef и formRef. typeRef из журналов следует убрать если не предполагается несколько журналов для одного типа.
22. MLText теперь стал Immutable структурой и метод set удален. Для удобства добавлен метод withValue, но он создает и возвращает новый инстанс MLText и нужно его не забыть куда-то сохранить.
