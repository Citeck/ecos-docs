

<!DOCTYPE html>
<html class="writer-html4" lang="ru" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ECOS Records API &mdash; ECOS</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/main_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="ECOS CMMN" href="ECOS_CMMN.html" />
    <link rel="prev" title="UX UI" href="UX_UI.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Citeck ECOS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Введение.html"><strong>Знакомство с ECOS</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Пример настройки процесса.html">Пример настройки процесса</a></li>
<li class="toctree-l1"><a class="reference internal" href="../База по настройке.html">База по настройке</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Администрирование.html">Администрирование</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Общая база знаний.html">Общая база знаний</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Глоссарий.html">Глоссарий</a></li>
<li class="toctree-l2"><a class="reference internal" href="Термины_системы.html">Термины системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="UX_UI.html">UX UI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><strong>ECOS Records API</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Общее описание</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Термины</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Описание работы с данными</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Синтаксис атрибутов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Контекстные атрибуты</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recordsservice-java">RecordsService (Java)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recordref">RecordRef</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Использование в браузере</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ECOS_CMMN.html"><strong>ECOS CMMN</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="Темы_интерфейса.html">Темы интерфейса</a></li>
<li class="toctree-l2"><a class="reference internal" href="Типы_действий.html">Типы действий</a></li>
<li class="toctree-l2"><a class="reference internal" href="Язык_предикатов.html">Язык_предикатов</a></li>
<li class="toctree-l2"><a class="reference internal" href="How_To.html">How To</a></li>
<li class="toctree-l2"><a class="reference internal" href="Notification.html">Уведомления (переходная версия)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Alfresco.html"><strong>Alfresco</strong></a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Citeck ECOS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../Общая база знаний.html">Общая база знаний</a> &raquo;</li>
        
      <li><strong>ECOS Records API</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/general/ECOS_Records.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ecos-records-api">
<h1><strong>ECOS Records API</strong><a class="headerlink" href="#ecos-records-api" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="id1">
<h2>Общее описание<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p>API, разработанное для организации простого и легко масштабируемого общения между потребителем информации и источником.
Источниками данных могут быть БД, alfresco, REST и др.</p>
<p>Преимущества:</p>
<ul class="simple">
<li>Единый API для доступа к данным в системе для всех потребителей (Браузер, Мобильное приложение, Система построения отчетов, Индексирование данных, Различные микросервисы и т.д.);</li>
<li>Поддержка загрузки данных из связанных сущностей. Например, если у нас договор ссылается на доверенность, то, имея идентификатор договора, мы можем получить любой атрибут связанной доверенности;</li>
<li>Оптимальность. Загружаются и вычисляются только те атрибуты, которые нужны потребителю;</li>
<li>Простота в разработке – разработчик источника данных описывает все атрибуты, которые могут запросить потребители вне зависимости от сложности их вычисления. Потребитель в запросе указывает только те атрибуты, в которых он заинтересован;</li>
<li>Простота поддержки - нет версионирования API т.к. мы в любой момент можем добавлять новые атрибуты, не трогая старые;</li>
<li>Тип получаемых данных полностью описывается запросом. Из источника данных мы возвращаем атрибуты с любым типом, а Records API приводит их к нужному для потребителя;</li>
<li>Вычисляемые атрибуты. Возможность добавлять атрибуты, которые не хранятся в БД или любом другом хранилище, а вычисляются на основе существующих;</li>
<li>Поддержка объединения атрибутов из разных источников. Например, можно написать источник данных, который часть атрибутов будет брать из alfresco, а часть из внешней БД объединяя их по идентификатору.</li>
</ul>
<p><strong>Важный момент:</strong> ECOS Records API - это <strong>НЕ GraphQL</strong>. Старые версии Records API использоавали GraphQL, но начиная с версии 3.0 API полностью самостоятелен.</p>
</div>
<div class="section" id="id2">
<h2>Термины<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<p>Общие:</p>
<ul class="simple">
<li>Атрибут (Attribute) – свойство или ассоциация сущности;</li>
<li>Сущность (Entity) – некоторый объект в системе (договор, доверенность, человек, группа, форма и др.);</li>
<li>Запись (Record) – сущность с набором атрибутов и идентификатором записи (RecordRef);</li>
<li>Идентификатор записи (RecordRef) – идентификатор источника данных и локальный идентификатор сущности в виде строки.</li>
<li>Источник данных (записей) (Records DAO) – источник данных, в котором описана логика базовых CRUD операций для работы с сущностями.</li>
</ul>
<p>Данные:</p>
<ul class="simple">
<li>Граф данных (Data Graph) – представление данных, которые может запросить клиент по схеме атрибутов;</li>
<li>Скаляр (Scalar) – некоторое финальное значение в графе данных, у которого нельзя запросить вложенные атрибуты (строка, число и др).</li>
<li>Схема атрибутов (Attributes Schema) – описание запроса данных для преобразования графа данных в наборы (map и list) значений скаляров;</li>
</ul>
</div>
<div class="section" id="id3">
<h2>Описание работы с данными<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h2>
<p>Очень часто данные не являются плоским списком, а представляют из себя граф, где сущности ссылаются друг на друга.
Ниже показан пример такого среза данных, где у нас есть договор с четыремя атрибутами:</p>
<ul class="simple">
<li>Заголовок (Title) - Строка</li>
<li>Имя (Name) - Строка</li>
<li><dl class="first docutils">
<dt>Контрагент (Counterparty) - Сложный объект</dt>
<dd><ul class="first last">
<li>Полное наименование (Full Organization Name) - Строка</li>
<li>Адрес контрагента (Counterparty Address) - Строка</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Валюта (Currency) - Сложный объект</dt>
<dd><ul class="first last">
<li><em>атрибуты пропущены для простоты</em></li>
</ul>
</dd>
</dl>
</li>
</ul>
<img alt="Data Graph" class="align-center" src="../_images/data_graph.png" />
<p>С точки зрения Records API каждый узел этого графа данных может быть получен как значение одного из скаляров:</p>
<ul class="simple">
<li><strong>disp</strong> - Человекочитаемый вид значения. (Примеры: Для договора - «Договор №2», Для пользователя - «Иванов Иван»);</li>
<li><strong>str</strong> - Строка;</li>
<li><strong>num</strong> - Число (Двойная точность. Если точности Double не хватает, то следует использовать str);</li>
<li><strong>bool</strong> - Булево значение;</li>
<li><strong>json</strong> - JSON представление значения. Допускаются массивы и объекты;</li>
<li><strong>id</strong> - глобальный идентификатор значения, который содержит идентификатор источника данных и локальный идентификатор. Актуален для сложных значений вроде «Договор», «Контрагент», «Валюта» и др.;</li>
<li><strong>localId</strong> - то же что и id, но без идентификатора источника данных;</li>
<li><strong>assoc</strong> - с точки зрения потребителя данных - то же что и id. Разница появляется при изменении (мутации) записи.</li>
</ul>
<img alt="Data Graph with Scalars" class="align-center" src="../_images/data_graph_with_scalars.png" />
<p>Для примера рассмотрим получение полного наименовария организации контрагента у договора.</p>
<img alt="Получение наименования контрагента" class="align-center" src="../_images/get_full_org_name.png" />
<p>Здесь мы используем javascript Records API для загрузки нужного нам атрибута.
Первая строка - получение записи по её идентификатору.</p>
<p><em>Прим. Общий вид идентификатора «приложение/источник_данных&#64;локальный_id», но здесь присутствует только локальный_id. Для API это означает, что приложение = «alfresco», а источник_данных = «» (пустой идентификатор зарезервирован за источником с нодами Alfresco)</em></p>
<p>Вторая строка - загрузка нужного нам атрибута. Вложенные атрибуты разделены точкой «.», а скаляр определяется знаком вопроса «?»</p>
<p><em>Прим. Допустимая вложенность атрибутов не ограничена</em></p>
</div>
<div class="section" id="id4">
<h2>Синтаксис атрибутов<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h2>
<p>Самый простой способ получить значение атрибута - это указать его имя:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span><span class="p">:</span><span class="n">name</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Двоеточие здесь - это часть имени и не является спец символом в данном контексте.</p>
</div>
<p>Если мы не указываем скаляр, то он по умолчанию принимается равным «?disp». То есть запись выше аналогична следующей:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cm:name?disp
</pre></div>
</div>
<p>Для значений с типом «Строка (String)» разницы между скалярами «?disp» и «?str» нету т.к. вернется одно и то же значение.</p>
<p>Для обращения к вложенному атрибуту следует разделять имена точкой:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>counterparty.fullOrgName?str
</pre></div>
</div>
<p>Если на каком-то из уровней в атрибуте ожидается список значений, то следует использовать квадратные скобки «[]» после имени атрибута:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>counterparty[].fullOrgName?str
cm:manager.cm:subordinates[].cm:userName?str
cm:manager.cm:department.managers[].cm:subordinates[].cm:userName?str
</pre></div>
</div>
<p>Если мы запросили атрибут без указания квадратных скобок, а источник данных вернул список, то мы получим только первый элемент из этого списка или null если список пустой.</p>
<p>Для получения сразу нескольких атрибутов у вложенного значения можно использовать фигурные скобки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span><span class="p">:</span><span class="n">manager</span><span class="o">.</span><span class="n">cm</span><span class="p">:</span><span class="n">subordinates</span><span class="p">[]{</span><span class="n">userName</span><span class="p">:</span><span class="s2">&quot;cm:userName?str&quot;</span><span class="p">,</span><span class="n">firstName</span><span class="p">:</span><span class="s2">&quot;cm:firstName&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>В результате получим следующую структуру:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
      <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;ivan.ivanov&quot;</span><span class="p">,</span>
      <span class="s2">&quot;firstName&quot;</span><span class="p">:</span> <span class="s2">&quot;Ivan&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
      <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="s2">&quot;petr.petrov&quot;</span><span class="p">,</span>
      <span class="s2">&quot;firstName&quot;</span><span class="p">:</span> <span class="s2">&quot;Petr&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>В атрибутах есть поддержка пост-процессоров, которые позволяют выполнять операции над результатом перед тем как вернуть его клиенту.</p>
<p>Пост-процессоры описываются после атрибута через символ вертикальной черты «|».</p>
<p><strong>Форматирование даты</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span><span class="p">:</span><span class="n">created</span><span class="o">|</span><span class="n">fmt</span><span class="p">(</span><span class="s2">&quot;yyyy__MM__dd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Подробнее о шаблоне для форматирования даты можно почитать здесь: <a class="reference external" href="https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html</a></p>
<p><strong>Форматирование числа</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecos</span><span class="p">:</span><span class="n">documentAmount</span><span class="o">|</span><span class="n">fmt</span><span class="p">(</span><span class="s2">&quot;00000.00&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Данный формат помогает дополнить число лидирующими нулями если его целая часть меньше 5 знаков и ограничивает числа после запятой двумя знаками</p>
<p>Подробнее о шаблоне для форматирования чисел можно почитать здесь: <a class="reference external" href="https://docs.oracle.com/javase/7/docs/api/java/text/DecimalFormat.html">https://docs.oracle.com/javase/7/docs/api/java/text/DecimalFormat.html</a></p>
<p><strong>Значение по умолчанию</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ecos:documentAmount?num|or(0)
</pre></div>
</div>
<p>Если атрибут ecos:documentAmount вернет null, то вместо него мы получим число 0.</p>
<p>Для процессора «or» есть короткая запись через «!»:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ecos:documentAmount?num!0
</pre></div>
</div>
<p>В процессоре «or» можно использовать другие атрибуты:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cm:title?str!cm:name?str
cm:title?str|or(&quot;a:cm:name?str&quot;)
</pre></div>
</div>
<p>В данном примере мы получим значение cm:title или значение cm:name если cm:title равен null или пустой строке.</p>
<p><em>Прим. данный атрибут приведен для примера и для получения «заголовок или имя» лучше использовать скаляр «?disp» т.к. у нод alfresco он по умолчанию реализован подобным образом</em></p>
<p>В полной форме нам нужно указать префикс «a:» чтобы обозначить, что нам нужно значение атрибута, а не константа «cm:name?str»
Если нам нужно строковое константное значение в короткой форме, то следует взять значение в кавычки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cm:title?str!&quot;cm:name&quot;
</pre></div>
</div>
<p><strong>Добавление префикса или суффикса</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span><span class="p">:</span><span class="n">name</span><span class="o">|</span><span class="n">presuf</span><span class="p">(</span><span class="s2">&quot;prefix-&quot;</span><span class="p">,</span><span class="s2">&quot;-suffix&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Если значение cm:name равно «Имя», то на выходе мы получим «prefix-Имя-suffix»
Значение суффикса можно не задавать. Если значение префикса не нужно, а значение суффикса нужно, то первым аргументом можно передать пустую строку.</p>
<p><strong>Процессоры можно объединять</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cm:title!cm:name!&quot;n-a&quot;|presuf(&quot;prefix-&quot;,&quot;-suffix&quot;)
</pre></div>
</div>
<ol class="arabic simple">
<li>Взять заголовок;</li>
<li>Если заголовок пустой, то взять имя;</li>
<li>Если имя пустое, то взять константу «n-a»;</li>
<li>Добавить к результату пунктов 1-3 префикс «prefix-«;</li>
<li>Добавить к результату пункта 4 суффикс «-suffix».</li>
</ol>
</div>
<div class="section" id="id5">
<h2>Контекстные атрибуты<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h2>
<p>Часто возникают ситуации когда нужно загрузить атрибуты, которые не относятся напрямую к сущности, а являются контекстными.
Пример таких атрибутов:</p>
<ul class="simple">
<li>Текущий пользователь</li>
<li>Текущая дата</li>
</ul>
<p>Для доступа к таким атрибутам при запросе данных к имени атрибута в начале добавляется знакк «$».</p>
<p>Т.о. если нам нужно получить имя текущего пользователя мы можем загрузить следующий атрибут:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$user.cm:userName
</pre></div>
</div>
<p>Если нам нужно получить текущую дату и отформатировать её:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$now|fmt(&quot;yyyy&quot;)
</pre></div>
</div>
<p>Список контекстных атрибутов, которые доступны во всех источниках:</p>
<ul class="simple">
<li>user - Текущий пользователь</li>
<li>now - Текущая дата</li>
</ul>
<p>Если в серверном коде нужно расширить доступный список контекстных атрибутов, то работу с RecordsService нужно выполнять следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">contextAtts</span> <span class="o">=</span> <span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span><span class="p">()</span>
<span class="n">contextAtts</span><span class="p">[</span><span class="s2">&quot;customVariable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecordRef</span><span class="o">.</span><span class="n">valueOf</span><span class="p">(</span><span class="s2">&quot;people@admin&quot;</span><span class="p">)</span>

<span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="o">.</span><span class="n">doWithAtts</span><span class="p">(</span><span class="n">contextAtts</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">recordsService</span><span class="o">.</span><span class="n">getAtt</span><span class="p">(</span><span class="s2">&quot;any-record&quot;</span><span class="p">,</span> <span class="s2">&quot;$customVariable?disp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">asText</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>В качестве значений для контекстных атрибутов могут быть RecordRef’ы (для доступа к другим сущностям) или значения любых других типов.</p>
</div>
<div class="section" id="recordsservice-java">
<h2>RecordsService (Java)<a class="headerlink" href="#recordsservice-java" title="Ссылка на этот заголовок">¶</a></h2>
<p>Сервис для работы с абстрактными записями, источником которых может быть любой DAO.</p>
<p>Существует четыре операции, которые можно проделывать над записями:</p>
<p><strong>а) Поиск записей</strong></p>
<p>Методы: query, queryOne</p>
<p>Для поиска записей всегда передается RecordsQuery, который содержит параметры поиска. Помимо самого простого метода для поиска с одним параметром RecordsQuery так же есть варианты с объединенным поиском и запросом атрибутов.</p>
<p><strong>б) Получение атрибутов записи</strong></p>
<p>Методы: getAtt, getAtts</p>
<p>Существует два уровня абстрации для получения атрибутов:</p>
<p>DTO Class &gt; Attributes</p>
<ul class="simple">
<li>DTO Class - класс, который используется для генерации списка аттрибутов для формирования схемы и запроса атрибутов из DAO.</li>
</ul>
<p>После получения всех данных из DAO идет создание инстансов переданного DTO класса и наполнение его данными с помощью библиотеки jackson;
Список аттрибутов формируется либо из названий полей, либо можно добавить аннотацию AttName для указания атрибута вручную.</p>
<ul class="simple">
<li>Attributes - аттрибуты записи в чистом виде. Есть варианты с одним атрибутом, списком атрибутов или набором ключ-&gt;значение (Map)</li>
</ul>
<p><strong>в) Мутация (изменение или создание) записи;</strong></p>
<p>Каждый DAO решает сам создавать или редактировать полученную запись.
Если в DAO приходит запись с пустым идентификатором, то это команда к созданию новой записи.</p>
<p><strong>г) Удаление записи;</strong></p>
</div>
<div class="section" id="recordref">
<h2>RecordRef<a class="headerlink" href="#recordref" title="Ссылка на этот заголовок">¶</a></h2>
<p>RecordRef - это идентификатор записи, который состоит из трех частей:</p>
<ol class="arabic simple">
<li>appName - идентификатор приложения, к которому относится запись;</li>
<li>sourceId - идентификатор локального (для приложения) источника данных, к которому относится запись;</li>
<li>id - локальный идентификатор, который должен быть уникален в пределах источника.</li>
</ol>
<p>Общий вид: «<a class="reference external" href="mailto:appname/sourceId&#37;&#52;&#48;id">appname/sourceId<span>&#64;</span>id</a>». / и &#64; - особые разделители.</p>
<ul class="simple">
<li>Если в RecordRef не задан sourceId, то источником по умолчанию считается - «» (пустая строка).</li>
</ul>
<p>В Alfresco с таким идентификатором зарегистрирован AlfNodesRecordsDAO - источник данных, у которого запись === нода Alfresco.
Из этого следует, что NodeRef.toString() === RecordRef.toString() для нод Alfresco;</p>
<p>Уровни детализации от меньшего к большему:</p>
<ul class="simple">
<li><a class="reference external" href="mailto:/&#37;&#52;&#48;localId">/<span>&#64;</span>localId</a> == &#64;localId == localId</li>
<li><a class="reference external" href="mailto:/sourceId&#37;&#52;&#48;localId">/sourceId<span>&#64;</span>localId</a> == <a class="reference external" href="mailto:sourceId&#37;&#52;&#48;localId">sourceId<span>&#64;</span>localId</a></li>
<li><a class="reference external" href="mailto:appName/sourceId&#37;&#52;&#48;localId">appName/sourceId<span>&#64;</span>localId</a></li>
</ul>
</div>
<div class="section" id="id6">
<h2>Использование в браузере<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для работы с Records API разработан компонент Citeck.Records, который доступен в глобальном контексте на любой странице системы. Доступные операции:</p>
<ul class="simple">
<li><strong>get(recordRef)</strong> - Получить запись по её идентификатору. Ниже представлен список операций с записью;</li>
<li><strong>query(query, attributes)</strong> - Поиск записей. Первый аргумент - запрос для поиска, а второй - какие атрибуты нам нужны у найденых записей;</li>
<li><strong>remove(records)</strong> - Удаление записей.</li>
</ul>
<p>Операции с записью, которая получена через метод «Citeck.Records.get»:</p>
<ul class="simple">
<li><strong>load(attributes, forceLoad)</strong> - Загрузить атрибут или несколько атрибутов. Первым аргументом мы указываем что нужно загрузить, а вторым следует использовать кэш или нет. Второй аргумент опционален и по умолчанию равен false (т.е. кэш активен);</li>
<li><strong>att(attributeName, value)</strong> - Проставить значение атрибута для записи. Используется перед сохранением записи;</li>
<li><strong>save()</strong> - Сохранить изменения в записи, которые были сделаны методом att из предыдущего пункта;</li>
</ul>
<p>Структура query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;sourceId&quot;</span><span class="p">:</span> <span class="n">String</span> <span class="o">//</span> <span class="n">идентификатор</span> <span class="n">источника</span> <span class="n">данных</span> <span class="n">в</span> <span class="n">формате</span> <span class="s2">&quot;приложение/id_локального_источника_данных&quot;</span>
  <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">Any</span> <span class="o">//</span> <span class="n">любой</span> <span class="n">формат</span><span class="p">,</span> <span class="n">который</span> <span class="n">поддерживается</span> <span class="n">источником</span> <span class="n">данных</span>
  <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">String</span> <span class="o">//</span> <span class="n">язык</span> <span class="n">для</span> <span class="n">определения</span> <span class="n">содержимого</span> <span class="n">query</span><span class="o">.</span> <span class="n">Источник</span> <span class="n">данных</span> <span class="n">может</span> <span class="n">поддерживать</span> <span class="n">несколько</span> <span class="n">языков</span>
  <span class="s2">&quot;sortBy&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
          <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">String</span> <span class="o">//</span> <span class="n">атрибут</span> <span class="n">для</span> <span class="n">сортировки</span>
          <span class="s2">&quot;ascending&quot;</span><span class="p">:</span> <span class="n">Boolean</span> <span class="o">//</span> <span class="n">сортировка</span> <span class="n">должна</span> <span class="n">быть</span> <span class="n">по</span> <span class="n">возрастанию</span> <span class="n">true</span> <span class="n">или</span> <span class="n">по</span> <span class="n">убыванию</span> <span class="n">false</span>
      <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;groupBy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">//</span> <span class="n">список</span> <span class="n">атрибутов</span> <span class="n">для</span> <span class="n">группировки</span>
  <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">maxItems</span><span class="p">:</span> <span class="n">Number</span> <span class="o">//</span> <span class="n">максимальное</span> <span class="n">кол</span><span class="o">-</span><span class="n">во</span> <span class="n">элементов</span>
      <span class="n">skipCount</span><span class="p">:</span> <span class="n">Number</span> <span class="o">//</span> <span class="n">количество</span> <span class="n">элементов</span><span class="p">,</span> <span class="n">которое</span> <span class="n">нужно</span> <span class="n">пропустить</span> <span class="n">при</span> <span class="n">поиске</span>
  <span class="p">}</span>
  <span class="s2">&quot;consistency&quot;</span><span class="p">:</span> <span class="n">EVENTUAL</span> <span class="o">|</span> <span class="n">TRANSACTIONAL</span> <span class="o">|</span> <span class="n">DEFAULT</span> <span class="o">|</span> <span class="n">TRANSACTIONAL_IF_POSSIBLE</span> <span class="o">//</span> <span class="n">ожидаемая</span> <span class="n">консистенция</span> <span class="n">данных</span><span class="o">.</span> <span class="n">EVENTUAL</span> <span class="n">позволяет</span> <span class="n">использовать</span> <span class="n">индексы</span> <span class="n">для</span> <span class="n">поиска</span> <span class="n">элементов</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Примеры использования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workspace://SpacesStore/16d8668d-7325-49ef-80d3-f2bfdb4c6d00&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">({</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;icase:caseStatusAssoc.cm:title?str&#39;</span><span class="p">,</span>
  <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;.disp&#39;</span>
<span class="p">});</span>

<span class="o">---</span>

<span class="k">await</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ecos-config@ecos-forms-enable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;.str&#39;</span><span class="p">);</span>

<span class="o">---</span>

<span class="k">await</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">query</span><span class="p">({</span>
  <span class="n">sourceId</span><span class="p">:</span> <span class="s1">&#39;alfresco/&#39;</span><span class="p">,</span>
  <span class="n">query</span><span class="p">:</span> <span class="s1">&#39;TYPE:&quot;cm:content&quot;&#39;</span><span class="p">,</span>
  <span class="n">language</span><span class="p">:</span> <span class="s1">&#39;fts-alfresco&#39;</span><span class="p">,</span>
  <span class="n">page</span><span class="p">:</span> <span class="p">{</span>     <span class="n">maxItems</span><span class="p">:</span> <span class="mi">10</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">[</span><span class="s1">&#39;cm:title&#39;</span><span class="p">,</span> <span class="s1">&#39;cm:name&#39;</span><span class="p">]);</span>

<span class="o">---</span>

<span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alfresco/people@admin&#39;</span><span class="p">);</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">load</span><span class="p">({</span>
  <span class="n">userName</span><span class="p">:</span> <span class="s1">&#39;cm:userName&#39;</span><span class="p">,</span>
  <span class="n">firstName</span><span class="p">:</span> <span class="s1">&#39;cm:firstName&#39;</span><span class="p">,</span>
  <span class="n">lastName</span><span class="p">:</span> <span class="s1">&#39;cm:lastName&#39;</span>
<span class="p">})</span>

<span class="o">---</span>

<span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alfresco/people@admin&#39;</span><span class="p">);</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">load</span><span class="p">([</span><span class="s1">&#39;cm:userName&#39;</span><span class="p">,</span> <span class="s1">&#39;cm:firstName&#39;</span><span class="p">,</span> <span class="s1">&#39;cm:lastName&#39;</span><span class="p">])</span>

<span class="o">---</span>

<span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Citeck</span><span class="o">.</span><span class="n">Records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alfresco/people@admin&#39;</span><span class="p">);</span>
<span class="k">await</span> <span class="n">user</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;cm:firstName&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ECOS_CMMN.html" class="btn btn-neutral float-right" title="ECOS CMMN" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="UX_UI.html" class="btn btn-neutral float-left" title="UX UI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Citeck.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>