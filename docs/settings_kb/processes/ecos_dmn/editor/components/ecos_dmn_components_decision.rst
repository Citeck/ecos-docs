Решение
========

.. _dmn_decision:

**Решение** - узел, в котором один или несколько входных элементов определяют выход на основе бизнес-логики принятия решения, определенной в виде выражения или таблицы.

При создании новой модели по умолчанию добавлен элемент **решение**:

 .. image:: _static/decision/decision_1.png
       :width: 600
       :align: center

Кликнув на решение, в правой части становятся доступны свойства элемента:

 .. image:: _static/decision/decision_2.png
       :width: 600
       :align: center

Кликнув дважды на элемент, его можно переименовать или наименование можно поменять в свойствах.

Для ввода данных в таблицу кликните:

 .. image:: _static/decision/decision_3.png
       :width: 200
       :align: center

Откроется таблица для заполнения:

 .. image:: _static/decision/decision_4.png
       :width: 600
       :align: center

По клику на **View DRD** осуществляется переход назад к модели принятия решения.

Далее рассмотрим элементы таблицы принятия решения.

Описание элементов таблицы принятия решений
----------------------------------------------

Таблица решений представляет собой логику принятия решений, которая может быть представлена в виде таблицы. 
Логика состоит из входов, выходов и правил.

 .. image:: _static/decision/decision_5.png
       :width: 600
       :align: center

1.	Наименование таблицы решений
2.	Политика выбора
3.	Входная запись
4.	Выходная запись
5.	Правило


Политика выбора
~~~~~~~~~~~~~~~~~~

 .. image:: _static/decision/decision_6.png
       :width: 200
       :align: center

Таблица решений имеет политику выбора, которая указывает, из чего состоят результаты оценки таблицы решений.

Политика выбора определяет, сколько правил таблицы решений может быть удовлетворено и какие из удовлетворяемых правил включаются в результат таблицы решений. 

Политики выбора **Unique, Any и First** всегда будут возвращать не более одного удовлетворяемого правила. 

Политики выбора **Rule Order и Collect** могут возвращать несколько удовлетворенных правил.


.. list-table::
      :widths: 10 30
      :header-rows: 1
      :class: tight-table 
      
      * - Политика
        - Описание
      * - **Unique (Уникальная)**
        - | Может быть выполнено только одно правило или вообще не может быть выполнено правило. Результат таблицы решений содержит выходные записи удовлетворенного правила.
          | Если выполняется более одного правила, нарушается политика уникального выбора.
          | Является политикой выбора по умолчанию.
      * - **First (Политика первого совпадения)**
        - | Можно удовлетворить несколько правил. Результат таблицы решений содержит только вывод первого выполненного правила.
      * - **Priority**
        - | ???
      * - **Any (Любая)**
        - | Можно удовлетворить несколько правил. Однако все удовлетворяемые правила должны генерировать один и тот же результат. 
          | Результат таблицы решений содержит только вывод одного из удовлетворенных правил.
          | Если выполняются несколько правил, которые генерируют разные выходные данные, политика выбора нарушается.
      * - **Collect (Сбор)**
        - | Можно удовлетворить несколько правил. Результат таблицы решений содержит вывод всех удовлетворяемых правил в произвольном порядке в виде списка.
          | Кроме того, для политики выбора Collect можно указать агрегатор.
          | Если указан агрегатор, результат таблицы решений будет содержать только одну выходную запись. Агрегатор сгенерирует выходную запись из всех удовлетворенных правил. 
          | Для политики выбора Collect доступны :ref:`следующие операторы<dmn_collect_operators>`
      * - **Rule order (Порядок применения правил)**
        - | Можно удовлетворить несколько правил. 
          | Результат таблицы решений содержит выходные данные всех удовлетворяемых правил в порядке следования правил в таблице решений.
      * - **Output order**
        - | ???

.. _dmn_collect_operators:

Операторы для политики выбора Collect:

.. list-table::
      :widths: 10 30
      :class: tight-table 
      
      * - **SUM**
        - Агрегатор SUM суммирует все выходные данные выполненных правил.
      * - **MIN**
        - Агрегатор MIN можно использовать для возврата наименьшего выходного значения всех удовлетворяемых правил. 
      * - **MAX**
        - Агрегатор MAX можно использовать для возврата наибольшего выходного значения всех удовлетворяемых правил.
      * - **COUNT**
        - Агрегатор COUNT можно использовать для возврата количества выполненных правил.

Входной элемент
~~~~~~~~~~~~~~~~~~

 .. image:: _static/decision/decision_7.png
       :width: 300
       :align: center

Таблица решений может иметь один или несколько входных элементов. Входной элемент определяет идентификатор, метку, выражение и тип ввода таблицы решений.

Ввод можно редактировать, дважды щелкнув заголовок соответствующего столбца в таблице решений.

.. list-table::
      :widths: 5 10 30 
      :class: tight-table 
      
      * - **1**
        - **Метка ввода**
        - Метка ввода — это краткое описание ввода.  Обратите внимание, что метка не обязательна, но рекомендуется, поскольку она помогает понять решение.
      * - **2**
        - **Expression**
        - | Входное выражение указывает, как генерируется значение входного предложения. 
          | Это выражение будет оцениваться механизмом DMN. Обычно это просто ссылка на переменную, которая доступна во время оценки.
      * - **3**
        - **Expression language**
        - | Язык входного выражения. Поддерживаемые языки выражений:
  
            -	JUEL
            -	FEEL

      * - **4**
        - **Input variable**
        - | Имя входной переменной. Когда входное выражение оценивается, возвращаемое значение сохраняется в переменной.
          | Переменная может использоваться в выражении входной записи. 
      * - **5**
        - **Type**
        - | Тип входного предложения. После того как входное выражение оценивается механизмом DMN, он преобразует результат в указанный тип.
          | Поддерживаемые типы:

            -	string	
            -	boolean	
            -	integer	
            -	long
            -	double
            -	date

Выходной элемент
~~~~~~~~~~~~~~~~~~

 .. image:: _static/decision/decision_8.png
       :width: 600
       :align: center

Таблица решений может иметь один или несколько выходных элементов.

Выходной элемент определяет идентификатор, метку, имя и тип вывода таблицы решений.

.. list-table::
      :widths: 5 10 30 
      :class: tight-table 
      
      * - **1**
        - **Метка вывода**
        - Метка вывода — это краткое описание вывода.  Обратите внимание, что метка не обязательна, но рекомендуется, поскольку она помогает понять решение.
      * - **2**
        - **Output name**
        - | Имя выхода используется для ссылки на значение выхода в результате таблицы решений.
          | Если таблица решений имеет более одного выхода, то все выходы должны иметь уникальное имя.
      * - **3**
        - **Type**
        - | После того, как выходная запись оценивается механизмом DMN, он преобразует результат в указанный тип. 
          | Поддерживаемые типы:
  
            -	string	
            -	boolean	
            -	integer
            -	long
            -	double
            -	date

Правило
~~~~~~~~

 .. image:: _static/decision/decision_9.png
       :width: 600
       :align: center

Таблица решений может иметь одно или несколько правил. Каждое правило содержит входные и выходные элементы. 

Входные элементы являются условием, а выходные элементы — заключением правила. Если каждый входной элемент (условие) выполняется, то правило выполняется и результат решения содержит выходные элементы (заключение) этого правила.

 .. image:: _static/decision/decision_10.png
       :width: 600
       :align: center

**1. Входной элемент**

Если входной элемент не имеет отношения к правилу, то выражение пусто.

Если в качестве языка выражений используется FEEL, то пустой входной элемент представлен как ``-`` . В противном случае выражение пусто.

Если глобальный язык выражений не установлен, вместо него используется язык выражений по умолчанию. Язык выражений по умолчанию для входных записей — `FEEL <https://docs.camunda.org/manual/7.18/reference/dmn/feel/>`_ 

**2. Выходной элемент**

Правило может иметь один или несколько выходных элементов, которые являются выводами правила.

Если выходной элемент пустой, то выходные данные игнорируются и не являются частью результата таблицы решений.

Если глобальный язык выражений не установлен, вместо него используется язык выражений по умолчанию. Язык выражений по умолчанию для выходных записей — JUEL.

**3. Описание:**

В правило может быть добавлено описание, содержащее дополнительную информацию.

