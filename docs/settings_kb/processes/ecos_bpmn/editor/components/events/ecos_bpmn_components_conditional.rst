Условие
========

.. _ecos_bpmn_conditional:

**Событие BPMN с типом «Условие» (условное событие)** используется для моделирования реакции бизнес-процесса на изменения условий. 

Условное событие запускает событие при выполнении определенного условия. Как только определенное условие выполнено, процесс продолжается.

Условное событие  всегда является обработчиком, т.е. его можно использовать как начальное событие подпроцесса события, как промежуточное событие (intermediate event) и граничное событие (boundary event). 
Начальное и граничное событие могут быть прерывающими (interrupting) и непрерывающими (non-interrupting).

Условное событие нельзя использовать в качестве завершающего события.

Условные события запускаются с помощью переменных процесса.

Условное начальное событие
----------------------------

Событие условного запуска можно использовать для запуска процесса путем оценки некоторого условия. Один процесс может иметь одно или несколько событий условного запуска.

Если выполняется более одного условия, будет запущено соответствующее количество процессов.

При развертывании определения процесса с условными событиями запуска применяются следующие соображения:

 -	Условие события условного запуска должно быть уникальным для данного определения процесса, т. е. в определении процесса не должно быть нескольких событий условного запуска с одним и тем же условием. Механизм выдает исключение при развертывании определения процесса, если два или более события условного запуска содержат одно и то же условие.
 - 	Управление версиями процесса: при развертывании новой версии определения процесса условные подписки предыдущей версии отменяются. Это также относится к условным событиям, которых нет в новой версии.

.. image:: _static/conditional_event_1.png
      :width: 300
      :align: center

Условное начальное событие для подпроцесса события
----------------------------------------------------

Подобно условным граничным событиям, условные начальные события для подпроцесса события могут быть прерывающими и непрерывающими.

Подпроцесс события должен иметь одно начальное событие.

.. image:: _static/conditional_event_2.png
      :width: 300
      :align: center

Условное граничное событие 
---------------------------

Условное граничное событие действует как наблюдатель, который срабатывает, если выполняется определенное условие. 

Прерывающее событие установлено по умолчанию. 

Непрерывающее событие приводит к тому, что исходная активность не прерывается, экземпляр остается активным. Вместо этого создается дополнительный путь исполнения, принимающий исходящий переход события. Непрерывающее условное событие может запускаться более одного раза, пока активность, к которой оно прикреплено, активна.

.. image:: _static/conditional_event_3.png
      :width: 400
      :align: center

Промежуточное событие условного захвата
-----------------------------------------

Промежуточное условное событие похоже на ожидание, пока условие не станет истинным. Когда выполнение достигает действия перехвата события, условие оценивается в первый раз. Если условие выполнено, процесс выполнения переходит к следующему действию. Если условие не выполняется, выполнение остается в этом действии до тех пор, пока условие не будет выполнено.

Промежуточное условное событие определяется как промежуточное событие перехвата.

.. image:: _static/conditional_event_4.png
      :width: 300
      :align: center

Настройка элемента
------------------

Чтобы указать, когда должно запускаться условное событие, необходимо заполнить раздел **«Условие»**. 
Условие может быть выражением ??? и иметь доступ к переменным экземпляра процесса. 

Условие оценивается каждый раз, когда изменяется переменная.    

Чтобы предотвратить непрерывную оценку условия, оценку можно ограничить конкретными изменениями. 

По умолчанию оценка условия запускается любым изменением переменной, т. е. созданием/обновлением/удалением любой переменной. Имя переменной можно использовать, чтобы ограничить это изменением конкретной переменной.
Событие переменной может использоваться для ограничения типа изменения. 

.. list-table::
      :widths: 5 5
      :align: center
      :class: tight-table 

      * - **Название события**

        - 
               .. image:: _static/conditional_event_5.png
                :width: 300
                :align: center
      * - | **Имя переменной**
          | По умолчанию вычисление условия происходит при обновлении каждой переменной. 
          | Вы можете задать имя переменной для ограничения вычисления только для конкретной переменной.

        - 
               .. image:: _static/conditional_event_6.png
                :width: 300
                :align: center

      * - | **События переменной**
          | Можно использовать для ограничения типа изменений:

                *	Создание
                *	Обновление
                *	Удаление
        - 
               .. image:: _static/conditional_event_7.png
                :width: 300
                :align: center

      * - Тип условия: **Выражение**

        - 
               .. image:: _static/conditional_event_8.png
                :width: 300
                :align: center

      * - Тип условия: **Скрипт**

        - 
               .. image:: _static/conditional_event_9.png
                :width: 300
                :align: center

      * - | Асинхронность можно настроить ко многим элементам. 
          | `См. подробнее <https://camunda.com/blog/2014/07/advanced-asynchronous-continuations/>`_ 

        - 
               .. image:: _static/conditional_event_10.png
                :width: 300
                :align: center

Оценка сверху вниз
--------------------

Изменение переменной вызывает оценку условия и запуск события сверху вниз. Это означает, что оценка начинается с условных событий области BPMN, в которой была изменена переменная. Затем он шаг за шагом спускается к экземплярам вложенных областей BPMN (например, встроенных подпроцессов). Это делается до тех пор, пока не будет инициировано условное событие, которое прерывает текущий экземпляр области (тем самым отменяя все дочерние элементы) или пока не останется более глубоких вложенных областей.

Например, см. следующую модель процесса BPMN:

Если переменная установлена в контексте экземпляра подпроцесса, то сначала оценивается условное граничное событие подпроцесса. Если условие выполнено, то выполнение прерывается, в противном случае *UserTask B* оценивается и запускается условное граничное событие, если условие выполнено.

.. image:: _static/conditional_event_11.png
      :width: 500
      :align: center

Оценка по объему
-----------------

Изменения переменных в контексте экземпляра области действия могут инициировать только те условные события, которым видна переменная , но не влияют на несвязанные экземпляры области. Это означает, что если переменная изменяется, оцениваются только те условные события, которые прослушиваются в контексте этого экземпляра области или его дочерних элементов.

См. следующую модель процесса BPMN:

.. image:: _static/conditional_event_12.png
      :width: 500
      :align: center

Если мы запустили описанный выше процесс и *UserTask B *и *UserTask A* активны, то иерархия экземпляров активности будет следующей:

.. code-block::

    ProcessInstance
        UserTask A
        SubProcess
            UserTask B

Если переменная задана в контексте экземпляра , то оценивается *SubProcess* только событие условной границы . *UserTask B* Граничное событие *UserTask A* не может инициироваться, так как переменная не видна в своем контексте. 

