Задача бизнес-правило
=======================

.. _business_rule_task:

.. note::

       Введенные в форму данные форме должны четкое соответствовать (включая регистр) входным элементам таблицы принятия решений.
       
       Будьте внимательны при сравнении строк и использовании символов в unicode.

Задача бизнес-правило служит для вызова :ref:`решения DMN<dmn_decision>` из процесса BPMN, используется для синхронного выполнения одного или нескольких правил.

Элемент выбирается следующим образом:

 .. image:: _static/business_rule_task/b_rule_1.png
       :width: 400
       :align: center

|

 .. image:: _static/business_rule_task/b_rule_2.png
       :width: 400
       :align: center

.. note::

      Выходной элемент решения, также называемый результатом решения, не сохраняется автоматически как переменная процесса. Вы должны указать **Переменную результата** и выбрать тип **Сопоставления результата решения**.

.. list-table::
      :widths: 5 5
      :class: tight-table 

      * - Указать **Имя**
        - 
               .. image:: _static/business_rule_task/b_rule_3.png
                :width: 250
                :align: center

      * - Выбрать **Решение** из списка созданных:
        - 
               .. image:: _static/business_rule_task/b_rule_4.png
                :width: 250
                :align: center

      * - | Выбрать **Связь** с версией решения:
          | 
          |  **Опубликованное с процессом** - рассчитывается версия решения, которая была опубликована вместе с версией процесса.
          |  **Актуальное** - всегда последняя версия решения.
          |  **Версия** - позволяет указать конкретную версию решения.
          |  **Тег версии** - позволяет указать конкретную версию решения по тегу.
        - 
               .. image:: _static/business_rule_task/b_rule_5.png
                :width: 250
                :align: center

      * - Укажите **Переменную результата** из списка созданных:
        - 
               .. image:: _static/business_rule_task/b_rule_6.png
                :width: 250
                :align: center

      * - | Выберите **Сопоставление результата решения** из списка созданных:
          | 
          |  **Собрать все объекты (List<Object>)** - таблицы решений с несколькими правилами сопоставления и только одним выходом
          |  **Список результатов (List<Map<String, Object>>)** - таблицы решений с несколькими правилами сопоставления и несколькими выходными данными
          |  **Один объект (TypedValue)** - литеральные выражения решений и таблицы решений с не более, чем одним правилом сопоставления и только одним выходом
          |  **Один результат (Map<String, Object>)** - таблицы решений с не более, чем одним правилом сопоставления
        - 
               .. image:: _static/business_rule_task/b_rule_7.png
                :width: 250
                :align: center

      * - Настройки асинхронности, см. подробнее о `асинхронных задачах <https://camunda.com/blog/2014/07/advanced-asynchronous-continuations/>`_ 
        - 
               .. image:: _static/business_rule_task/b_rule_8.png
                :width: 250
                :align: center


Как :ref:`Input variable<input_variable>` для DMN можно использовать переменные процесса. Для этого можно сохранить информацию из документа в переменную процесса и далее ее использовать.

Например:

 .. image:: _static/business_rule_task/b_rule_10.png
       :width: 500
       :align: center

Со следующим скриптом:

.. code-block::

       execution.setVariable('price', document.load("price?num"));


Вариант без использования :ref:`script task<script_task>` подходит только для простых случаев и если данные уже "готовы". 
Можно напрямую получить **recordsService** в **expression**, только обязательно необходимо указать язык **juel**.

Например:

.. code-block::

       Records.get(documentRef).load("color")

Настройки в :ref:`DMN решении<dmn_decision>`

 .. image:: _static/business_rule_task/b_rule_9.png
       :width: 500
       :align: center

