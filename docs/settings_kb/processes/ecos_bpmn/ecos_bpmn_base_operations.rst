Базовые операции
================

.. contents:: 

Список процессов
----------------

Процессы сгруппированы по разделам и могут быть представлены в виде плиток|списка:

.. list-table::
      :widths: 10 20
      :header-rows: 1
      :align: center
      :class: tight-table 

      * - **Представление в виде плиток:**
        - 

            .. image:: _static/03a.png
                  :width: 600
                  :align: center

      * - **Представление в виде списка:**
        - 

            .. image:: _static/03b.png
                  :width: 600
                  :align: center

Для просмотра/редактирования процесса наведите курсор мышь на плитку:

 .. image:: _static/10.png
       :width: 700
       :align: center

Действия с разделами
~~~~~~~~~~~~~~~~~~~~~~

Для разделов доступны следующие действия:

 .. image:: _static/category_actions.png
       :width: 600
       :align: center

.. list-table::
      :widths: 10 20
      :header-rows: 1
      :align: center
      :class: tight-table 

      * - Действие
        - Описание
      * - **Изменить**
        - Переименовать категорию:

            .. image:: _static/category_actions_2.png
                  :width: 500
                  :align: center

      * - **Создать модель**
        - :ref:`Создание нового бизнес-процесса<new_bp>`
      * - **Удалить**
        - Удалить категорию

            .. image:: _static/category_actions_3.png
                  :width: 300
                  :align: center

      * - **Добавить подкатегорию**
        - Создание в категории подкатегории с кодом (при необходимости) и наименованием:

            .. image:: _static/category_actions_1.png
                  :width: 500
                  :align: center

      * - **Редактировать права**
        - :ref:`Редактирование прав на категорию<bpmn_permissions>`

.. _bp_actions:

Карточка бизнес-процесса
------------------------

Для созданного процесса доступны следующие опции:

 .. image:: _static/04.png
       :width: 200
       :align: center

* **Просмотр** - карточка процесса с виджетами:
  
        .. image:: _static/05.png
            :width: 600
            :align: center

      **1.** Виджет :ref:`Статистика процесса<widget_process_statistics>` визуализирует статистику по бизнес-процессу с отображением тепловой карты (heatmap): 

        .. image:: _static/05_1.png
            :width: 600
            :align: center

      **2.** Виджет **«Свойства»** с информацией о процессе.

      **3.** Виджет :ref:`Комментарии<widget_comments>` 

      **4.** Виджет :ref:`История событий<widget_events-history>` для отображения событий бизнес-процесса.

      **5.** Виджет **«Действия»**, в котором доступны:

           - **Копировать** - копирует данный бизнес-процесс. В открывшейся форме введите новый **Идентификатор** и нажмите **«Подтвердить»**

                  .. image:: _static/05_3.png
                        :width: 400
                        :align: center

            Бизнес-процесс будет скопирован как новый со всеми настройками. 

           - **Скачать** - скачать процесс в формате xml;
           - **Скачать описание БП** -  осуществляется выгрузка модели бизнес-процесса в Excel. Подробнее см. :ref:`ниже<bp_to_excel>` :

                  .. image:: _static/05_2.png
                        :width: 800
                        :align: center

      **6.** Виджет :ref:`Журнал версий<widget_versions_journal_bpmn>` содержит актуальную и предшествующие версии бизнес-процесса.

*	**Удалить**
*	**Редактировать карточку процесса:** 

        .. image:: _static/06.png
            :width: 600
            :align: center

*	**Редактировать бизнес-процесс:**

        Откроется :ref:`конструктор бизнес-процесса<modeller_bp>`

        .. image:: _static/07.png
            :width: 600
            :align: center

.. _new_bp:

Создание бизнес-процесса
---------------------------

Для создания нового бизнес-процесса перейдите в журнал **"Модели BPMN" (Рабочее пространство "Раздел администратора" - Управление процессами)**:

 .. image:: _static/08.png
       :width: 300
       :align: center

Или в разделе выберите действие:

 .. image:: _static/08_1.png
       :width: 500
       :align: center

Откроется форма создания карточки процесса:

 .. image:: _static/09.png
       :width: 600
       :align: center

.. list-table:: Описание полей формы
      :widths: 10 20 30
      :header-rows: 1
      :align: center
      :class: tight-table 

      * - п/п
        - Наименование
        - Описание
      * - 1
        - **Идентификатор**
        - уникальный идентификатор
      * - 2
        - **Имя**
        - наименование создаваемого бизнес-процесса
      * - 3
        - **ECOS Type**
        - тип данных. При привязке к типу данных можно автоматически начинать процесс, если проставлен  чекбокс **(7)**. На форме редактора на основе типа данных будут подтягиваться роли, статусы и т.д.
      * - 4
        - **Раздел**
        - наименование раздела, в котором будет сохранен процесс. Если не заполнять, то сохранение происходит в раздел "По умолчанию".
      * - 5
        - **Форма**
        - указать для запуска (старта) процесса через форму.
      * - 6
        - **Включен**
        - включение процесса
      * - 7
        - **Автоматический старт процесса**
        - при создании объекта указанного типа процесс будет запущен автоматически.
      * - 8
        - **Автоматическое удаление процесса**
        - при удалении объекта указанного типа, процесс будет удален автоматически. По умолчанию включено.

Сохранение и публикация процесса
---------------------------------

.. _save_bp:

 .. image:: _static/78.png
       :width: 700
       :align: center

Процесс можно:

.. list-table::
      :widths: 1 3 5
      :align: center
      :class: tight-table 

      * - **1** 
        - **Сохранить как черновик** 
        - Без проверки валидности (наличия логических ошибок) и конвертации в Citeck формат.
      * - **2**
        - **Сохранить** 
        - С проверкой валидности (наличия логических ошибок) и конвертацией в Citeck формат.
      * - **3**
        - **Сохранить и опубликовать**
        - С проверкой валидности (наличия логических ошибок), конвертацией в Citeck формат, публикацией, чтобы процесс стал исполняемым.

.. note:: 

      Если вы отредактировали процесс, то его необходмо опубликовать заново, чтобы применить изменения и сделать их доступными для пользователей. Таким образом вы создаете новую версию процесса.

      В виджете :ref:`История событий<widget_versions_journal>` отображается информация о событиях создания, обновления, публикации бизнес-процесса с указанием автора, времени, комментария и т.д. 

      В виджете :ref:`Журнал версий<widget_versions_journal>` для версии процесса, которая была опубликована, будет показываться тег **"Опубликовано"**, для процесса, сохраненного как черновик - **"Черновик"**.

.. _new_bp_start:

Способы запуска бизнес-процесса
---------------------------------

Существует два способа запуска бизнес-процесса:

**1. Автоматический запуск БП при создании документа**

Осуществляется автоматически, если в описании БП указать необходимый **«ECOS Type»** и выставить флаг **«Автоматический старт процесса»** в положение истина.

**2. Ручной запуск БП через форму**

В описании БП в поле **«Форма»** можно указать форму запуска процесса, тогда ручной запуск осуществляется через **«Меню» -> «Создать» (+)**.

Способы автоматического старта и ручного запуска могут использовать как вместе, так и отдельно, в зависимости от бизнес требований.

В независимости от того, каким образом осуществляется старт бизнес-процесса, для возможности запуска, он должен быть **«включен»**. 

Старт процесса при нажатии кнопки «Отправить» (Submit) на форме создания/редактирования документа
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. _bp_submit:

Если рекорд сохраняется в состоянии **Черновик**, то есть через сабмит кнопку с состоянием **draft**,

.. image:: _static/draft_submit.png
       :width: 600
       :align: center

то :ref:`автоматический старт процесса<new_bp_start>` не осуществляется. Автоматический старт произойдет при сабмите без состояния черновика.

Запуск бизнес-процесса у дочерних типов
-----------------------------------------

.. _inherit_bp_start:

Рассмотрим на примере.

Например, имеем тип **А**, у него дочерний тип **А_1**

1. Если для типа **А** настроен БП включенный + автостарт, а для типа **А_1** отсутствует БП, то при создании объекта с типом **А_1**, будет стартовать БП, настроенный для типа **А**.
2. Если для типа **А** настроен БП включенный + автостарт, а для типа **А_1** настроен БП выключенный, то при создании объекта с типом **А_1**, будет стартовать БП, настроенный для типа **А**.
3. Если для типа **А** настроен БП включенный + автостарт, а для типа **А_1** настроен БП включенный + выключен автостарт, то при создании объекта с типом **А_1**, не будет произведен старт БП.
4. Если для типа **А** настроен БП включенный + автостарт, а для типа **А_1** настроен БП включенный + включен автостарт, то при создании объекта с типом **А_1**, будет стартовать БП, настроенный для типа **А_1**.

Выгрузка БП в виде Excel таблицы
---------------------------------

.. _bp_to_excel:

Необходимые версии микросервисов: **ecos-process = 2.16.0** и **ecos-transformation = 1.8.0**

Каждый BPMN шаблон имеется возможность скачать в виде **xlsx** файла. Для этого в системе существует шаблон с id = **ecos-bpmn-def-template**. В него заложены 2 шаблонных xlsx файла для следующих локалей: **ru** и **en**.

Также для каждого БП имеется действие для скачивания **Скачать описание БП**,  при активации которого на основе сохраненного в системе БП будет скачиваться файл xlsx, в котором будут зафиксированы все элементы из БП и связи между ними.

Достигается это за счет параметра **bpmn-report**, который мы можем запросить у каждого БП, используя Records API.

.. code-block::

    Records.get('eproc/bpmn-def@meet-process').load('bpmn-report[]?json');

Данный запрос вернет список объектов, сгенерированных на основе элементов в БП.

Более подробное описание объектов, заполяющих список можно найти в **ecos-process**:

.. code-block::

    ru.citeck.ecos.process.domain.bpmnreport.model.ReportElement


Настройка меню
---------------

Для добавления процесса в меню **«Создать»**:

1.	Перейти в настройку меню, нажав на шестеренку, потом кнопку **«Настроить меню»** справа сверху.

 .. image:: _static/79.png
       :width: 600
       :align: center

2.	Выбрать элемент меню, в котором будет находиться процесс. Навести на элемент и нажать кнопку **«Добавить»**:

  .. image:: _static/80.png
        :width: 600
        :align: center

  - для описанного выше способа **1** выбрать **«Добавить ссылку на создание кейса»** из списка выбрать необходимый тип данных, нажать **«ОК»**:

  .. image:: _static/81a.png
        :width: 600
        :align: center

  - для описанного выше способа **2** выбрать **«Запустить бизнес-процесс»**, из списка выбрать необходимый процесс, нажать **«ОК»**.

 .. image:: _static/81b.png
       :width: 400
       :align: center

|

 .. image:: _static/82.png
       :width: 600
       :align: center

Добавленный пункт меню:

 .. image:: _static/83.png
       :width: 200
       :align: center


Форма запуска БП:

 .. image:: _static/84.png
       :width: 600
       :align: center

