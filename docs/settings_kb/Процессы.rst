Процессы
=========

Редактор бизнес-процессов (BPMN)
--------------------------------

Создание процесса
~~~~~~~~~~~~~~~~~

**Создание процесса во Flowable**

1. Выбираете вкладку Процессы на верхней панели.
2. Выбираете один из предложенных процессов или нажимаете кнопку :guilabel:`Создать процесс`: 

.. image:: _static/process_flowable_1.png
        :align: center

**Cоздание процесса через Редактор бизнес-процессов**

1. В левой панели меню выбираете раздел :guilabel:`Редактор бизнес-процессов`.

.. image:: _static/create_proccess_1.png
        :align: center



2. Далее нажатием на иконку :guilabel:`+` в верхнем левом углу открывшегося окна выбираете опцию **Создать процесс**.

.. image:: _static/proccess_details.png
        :align: center

Формирование модели созданного процесса
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

3. Заполняете поля **Наименование модели** и **Ключ бизнес-процесса**, нажимаете :guilabel:`Создать новую модель`. 

Открывается страница старта формирования модели процесса. В левой панели хранятся события, которые можно использовать при создании, основное поле - для создания модели, снизу есть кардлет с параметрами объекта модели (например, исполнитель задачи, её наименование, слушатели события и так далее):
   
.. image:: _static/process_flowable_2.png
        :align: center

4. Для процесса с минимальным набором типов событий (пользовательские действия и системные проверки) достаточно того количества элементов, которое появляется при клике на событие старта на экране:
   
.. image:: _static/process_flowable_3.png
        :align: center

* Значок, выделенный красной стрелкой - **пользовательская задача**; 
* синей  - **гейтвей**; 
* жёлтой - стрелка для указания **связи между событиями**, 
* фиолетовой - **настройка элемента**. 

Например, при выбора гейтвея по умолчанию на экране отображается "ИЛИ". Для выбора типа "Параллельная развилка" необходимо нажать на значок гаечного ключа и во всплывающем окне выбрать **Parallel gateway** + **Выбрать**.

5. Для того, чтобы создать связь с объектом, создавая его с помощью всплывающего меню, достаточно просто зажать новый объект кнопкой мыши и немного "протянуть" его вверх или вправо. Стрелка связи установится автоматически. В случае создания связи между двумя уже существующими объектами необходимо выбрать один из них, выбрать стрелку (выделено жёлтой стрелкой), зажать стрелку и "протянуть" (как drag&drop) до второго объекта. Чтобы визуально сменить внешний вид стрелки с 
    
.. image:: _static/process_flowable_4.png
        :align: center

НА

.. image:: _static/process_flowable_5.png
        :align: center

ИЛИ НА

.. image:: _static/process_flowable_6.png
        :align: center

необходимо "зажать" второй объект и выровнять его с первым. После этого объект можно перемещать по экрану, стрелка будет образовывать угол в 90 градусов, где необходимо.

6. Для изображения свимлейнов необходимо использовать раздел :guilabel:`Swimlanes` левого меню. Сначала выбор **Pool** ("зажать" мышкой и вытащить на основное поле), после этого для создания следующей роли надо выбрать **Lane**, вытащить на основное поле на **Pool** и подвести к краю **Pool** (пока не появятся зелёные границы): 
 
.. image:: _static/process_flowable_7.png
        :align: center

После этого в Pool появляются уже 2 лейна, а не один:

.. image:: _static/process_flowable_8.png
        :align: center

Добавлять можно любое количество дорожек.

7. Редактирование длины *Pool&Lane*: можно увеличивать высоту/длину как всего Pool, так и отдельных Lane. Для того, чтобы переместить на экране/"протянуть" pool целиком, необходимо "встать" на него мышкой в левом верхнем углу и проверить, что весь pool выделился прерывистой линией, после чего с помощью "уголков" (подчёркнуты красным) можно произвести необходимые действия: 

.. image:: _static/process_flowable_9.png
        :align: center

Чтобы отредактировать длину/высоту конкретного Lane, надо "встать" мышкой на него (а не на весь pool) и теми же уголками изменить его размер.

8. Редактирование canvas: после того, как опция увеличения длины (см. п. 7) станет недоступна (как если бы возможность протягивать закончилась), наведите мышку на самую правую панель. На ней должны будут появиться стрелки, нажатием на которые можно увеличить размер основного окна вправо или влево (как на рисунке): 
   
.. image:: _static/process_flowable_10.png
        :align: center

Аналогичные стрелки для увеличения основного окна вверх и вниз можно увидеть, наведя мышью на область снизу рисунка. На текущий момент только в Safari удалось продлевать pool&lane без ограничений.


9. В случае если есть необходимость в валидации созданного процесса надо нажать значок :guilabel:`V` на верхней панели:

.. image:: _static/process_flowable_11.png
        :align: center

Система выведет список ошибок и предупреждений. При нажатии на конкретную ошибку/предупреждение система произведёт редирект именно на то место в схеме, где допущена ошибка.

10. Для того, чтобы сохранить созданную схему, необходимо нажать на значок дискетки рядом с :guilabel:`V` (см. рисунок выше) и выбрать :guilabel:`Сохранить и закрыть редактор` (после нажатия редирект на страницу процессов) или :guilabel:`Сохранить` (после нажатия возврат в редактор).

Редактор процесса Flowable
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Неочевидные настройки
"""""""""""""""""""""""
1) При создании новых пользователей, которые будут участвовать в демонстрации процесса, надо добавить им право работать в Workflow:

.. image:: _static/process_flowable_cor_1.png
        :align: center


2) В названии ключа элемента не должно быть пробелов - аккуратнее с копированием   
3) В условиях переходов логические операнды - не AND и OR, а  && и  ||
4) В условиях переходов ссылка на результат (кнопку) формы имеет синтаксис: **${form_КЛЮЧ ФОРМЫ_outcome == "ОК"}**

Привязка формы к процессу
~~~~~~~~~~~~~~~~~~~~~~~~~

Для того чтобы к процессу привязать форму необходимо заполнить **Form key** и указать название формы.

.. image:: _static/proccess_link_form1.png
        :align: center


* Чтобы добавить ответственных за task необходимо заполнить **Assigments**, где можно использовать существующие системные роли
* или указать свои роли в типе данных как показано на скриншоте ``${flwRecipients.getRoleUsers(document, 'trade-case-initiator-role')}``, где ``'trade-case-initiator-role'`` - ваша роль.

.. image:: _static/proccess_link_form2.png
        :align: center

Для того чтобы применялся статус в типе данных по процессу необходимо заполнить **Task Listener**:

``${caseStatusService.setStatus(document, "trade-primary-contact")}``,  где trade-primary-contact - ваш статус.
        
.. image:: _static/proccess_link_form3.png
        :align: center

Сервисы Flowable
~~~~~~~~~~~~~~~~~

Уведомления Flowable
~~~~~~~~~~~~~~~~~~~~~

Редактор сценариев (CMMN)
------------------------------

Для того чтобы все корректно работало, необходимо создать новый **CMMN сценарий**.

.. image:: _static/proccess_cmmn_1.png
        :align: center


При создании нового CMMN сценария необходимо его привязать к нужному **Типу данных**, и проставить галочку в опции :guilabel:`Enabled`.

.. image:: _static/proccess_cmmn_2.png
        :align: center


Чтобы проверить успешное создание Сценария необходимо открыть его в новом окне.

.. image:: _static/proccess_cmmn_3.png
        :align: center

.. image:: _static/proccess_cmmn_4.png
        :align: center


Где необходимо добавить нужный нам процесс.

.. image:: _static/proccess_cmmn_5.png
        :align: center

.. image:: _static/proccess_cmmn_5_1.png
        :align: center

Работа в связке CMMN - BPMN
-----------------------------