Работа с событиями (events) 
===========================================

Events 2.0
-----------

Реакция на события (events) строится на основе rabbitmq и моделей events в библиотеке - `ecos-events <https://github.com/Citeck/ecos-events>`_. На стороне producer и consumer строится подключение к rabbitmq. Пример: отправка уведомлений как реакция на событие - сменился статус, изменился атрибут, назначилась задача и т.д.

Архитектура
~~~~~~~~~~~

.. image:: _static/events/notification_through_events_2.0.png
       :align: center


События (Record Event)
--------------------------------------------

Система событий с возможностью при подписании указать атрибуты, которые необходимы слушателю.

Этап подписания на событие:

Если слушатель поднялся раньше чем источник событий:

1. При старте источник событий рассылает через MQ запрос на всех заинтересованных слушателей
2. Все заинтересованные слушатели отправляют в ответ список атрибутов, в которых они заинтересованы и идентификаторы своих очередей

Если источник событий поднялся раньше слушателя:

1. При старте слушатель рассылает через MQ запрос на подписание указав идентификатор очереди и необходимые атрибуты

Этап возникновения события:

1. Подготавливается базовая информация по событию
2. Происходит получение атрибутов, в которых заинтересованы слушатели
3. Обогащенное атрибутами событие отправляется в очереди всех заинтересованных слушателей
