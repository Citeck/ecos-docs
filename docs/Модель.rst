.. _ecos-model_label:

============================
**Хранение данных (Модель)**
============================

Ecos data model
------------------
При редактировании типа кейса есть возможность настроить атрибуты типа на вкладке “Модель”.

.. image:: _static/model_v4.png
       :scale: 90 %
       :align: center

Id - идентификатор поля, по которому оно будет доступно на форме, в журнале и других местах.

Name - имя поля для отображения пользователю

Тип - тип поля. Поддерживаются: 

* Text - текстовые данные;

* Association - связь с другой сущностью;

* Boolean - булево значение да/нет;

* Number - число;

* Date - дата;

* DateTime - дата с временем;

* Content - содержимое. Как правило поля с этим типом используются для сохранения больших объемов данных. Например - содержимое документа. Рекомендуется использовать только если стандартный cm:content не подходит;

* Computed - настройка динамически вычисляемого атрибута

Атрибуты модели
---------------

Вычислямеые атрибуты
~~~~~~~~~~~~~~~~~~~

.. image:: _static/Модель_вычисляемые_атрибуты.png
       :scale: 90 %
       :align: center

Тип - тип вычисляемого атрибута. Поддерживаются:

 * Script - вычисление атрибута на основе javascript'а;
 * Attribute - вычисление атрибута на основе другого атрибута (можно делать алиас на глубоко вложенный атрибут. Например: idocs:counterparty.idocs:fullOrganizationName?str);
 * Value - константное значение;
 * Template - шаблонная строка. Можно использовать вставки вида ${…}. Например: ${someAttribute?str}. Вместо данного плейсхолдера будет подставлено значение укзанного атрибута;
 * Counter - значение будет генерироваться по счетчику при создании документа и не меняться со временем;
 
Storing type - тип сохранения

Определяет нужно или нет сохранять вычисленное значение и если да, то в какие моменты. Возможные значения:

* None - сохранение не нужно. При каждом обращении вычисляем значение заново;
* On empty - сохранять вычисленное значение только если сохраненное значение отсутствует (т.е. при запросе значения вернулся null);
* On create - сохранять вычисленное значение только после создания. Последующие мутации никак данный атрибут не затронут и он будет работать как обычный атрибут.
* On mutate - сохранять вычисленное значение при каждой мутации. В случае использования Records API для изменения записи гарантируется актуальность значения.

Возможности атрибута с типом script
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Объекты в глобальной области видимости:

* Records - адаптер для RecordsService;
* value - текущий документ;
* log - логгер;

.. Warnning:: прикладных сервисов в контексте скрипта нет.

Описание value::

 Свойства:
 id: String //глобальный идентификатор записи
 localId: String //локальный идентификатор записи

 Методы:

 load(attributes: Any?): Any? // загрузка атрибутов у текущей записи. Можно передавать массив, строку и объект <String, String>

Описание Records::

 Методы:

 get(recordRef: String): AttValueScriptCtx // возвращает объект аналогичный value, который описан выше
 query(query: Object, attributes: Any?) // возвращает объект вида:

 {
  "records": [
    {
      "id": "workspace://...",
      "attribute0": "value0",
      "attribute1": "value1"
    },
    {
      "id": "workspace://...",
      "attribute00": "value00",
      "attribute11": "value11"
    }
  ],
  "totalCount": 123
  "hasMore": true
 }

Права на атрибуты (Type Permission)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Использование атрибутов модели на форме
---------------------------------------

Для использование атрибутов на форме нужно, чтобы Id атрибута соответствовал значению Property Name на форме.

Если Id атрибута содержит двоеточие “:”, то следует  на форме использовать Custom Properties → attribute (если двоеточия нету, то Property Name более чем достаточно).


.. image:: _static/model_by_form_1.png.png
       :scale: 100 %
       :align: center

.. image:: _static/model_by_form_2.png.png
       :scale: 60 %
       :align: left

.. image:: _static/model_by_form_3.png.png
       :scale: 60 %
       :align: right
       

Настройка статусов
-----------------------------------------------------