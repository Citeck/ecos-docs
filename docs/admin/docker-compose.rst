Инструкция по установке Citeck ECOS c помощью Docker-compose
================================================================

1.	Общие требования к системе
-------------------------------------------------------------
Просим обратить внимание, что:
 *	Docker Desktop for Windows требует для работы Microsoft WSL2.
 *	Выделенные **жирным шрифтом**, команды в данной инструкции необходимо выполнять в эмуляторе терминала или в Git CMD Windows.
 *	Все действия рекомендуется выполнять в командной строке или окне терминала, запущенные с повышенными правами.
Системные требования:
 *	Windows 10 64bit: (версия 1903 или более поздняя со сборкой 18362 или более поздней версии).
 *	Linux kernel version 3.10.0 или выше.
 *	Виртуализация разрешена в BIOS.
 *	Процессор	с	поддержкой	CPU	SLAT	(Second	Level	Address Translation).
 *	Минимум 10 GB ОЗУ.
 *	Минимум 4 ядра


2.	Установка Docker
-------------------------------------------------------------
Про установку Docker Desktop на всех ОС можно ознакомиться `на официальном сайте Docker по <https://docs.docker.com/get-docker/>`_

3.	Запуск проекта 
-------------------------------------------------------------

3.1 Преконфигурационная подготовка
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

3.1.1 Windows
"""""""""""""""""""""""""""""""


После установки Docker Desktop необходимо переключить на ядро Lunix с по-мощью WSL2. Инструкцию по переходу на WSL2 можно найти по `ссылке <https://docs.docker.com/docker-for-windows/wsl/>`_

3.1.2 Правка файла hosts
"""""""""""""""""""""""""""""""

Путь к папке, где лежит файл hosts, зависит от операционной системы, которая установлена на вашем компьютере: Windows— c:/windows/system32/drivers/etc/hosts. Linux, Ubuntu, Unix, BSD — /etc/hosts. Mac OS — /private/etc/hosts.

* Открыть файл hosts в редакторе с повышеными правами
* Добавить строчку: “127.0.0.1 ecos-community-demo” (без кавычек), 
* Сохранить

3.1.3 MacOS
"""""""""""""""""""""""""""""""

Создать папку и выдать к ней доступ во вкладке Resources в настройках Docker

3.2.	Запуск проекта
~~~~~~~~~~~~~~~~~~~~~~~~~
 * Установите и запустите Docker Compose 
 * Установите и запустите Git с повышенными правами
 * Выполните команду для скачивания репозитория: **git clone -b 3.23.0 https://gitlab.citeck.ru/ecos-community/ecos-community-demo.git**
  
 где 3.23.0 - версия проекта (поддерживается две версии community. Для скачивания 4-й версии использовать 4.0.0rc2. Если необходимо обновиться с версии 4.0.0rc1 до версии 4.0.0rc2, то рекомендуется выполнить миграцию по `инструкции <https://github.com/Citeck/ecos-docs/blob/main/docs/migration.rst>`_
 
 *	Перейдите в созданную папку: ecos-community-demo
 *	Выполнить docker-compose pull
 * Выполнить docker-compose up -d
 *	Перейти в браузере по адресу `http://ecos-community-demo/ <http://ecos-community-demo/>`_ 
 *	Войти в систему, используя следующие учётные данные (для 3.хх.х версии): 

Логин – admin | 
Пароль - ec0spa55wd

 * Войти в систему, используя следующие учётные данные (для 4.х.х версии)
 
Логин - admin |
Пароль - admin
 
 При первом развертывании keycloak попросит сменить пароль.
 Если необходимо еще раз сменить пароль, инструкция  `здесь <https://www.keycloak.org/docs/latest/getting_started/index.html#creating-a-user>`_
 
 * Учетные данные для Flowable-modeler:
 
Логин – admin |
Пароль: flowablepassword


4.	Известные проблемы
-------------------------------------

4.1.	Чистка данных
~~~~~~~~~~~~~~~~~~~~~~~
В случае если сначала была развернута 4-я версия, а затем нужно развернуть 3-ю, или нужно развернуть community на чистой базе, нужно удалить папку по пути:

 * для Windows

``\\wsl$\docker-desktop\mnt\version-pack\containers\services\docker\rootfs\opt\ecos-community-demo-data``

 * для Linux
 
``/opt/ecos-community-demo-data``
